<div class="assignment-requests-container">
  <!-- Header Section -->
  <div class="header-section">
    <h2 class="page-title">Machine Assignment Requests</h2>
    <div class="header-actions">
      <button class="btn btn-outline-secondary" (click)="refreshRequests()" [disabled]="isLoading">
        <i class="material-icons">refresh</i>
        Refresh
      </button>
    </div>
  </div>

  <!-- Error Alert -->
  @if (error) {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="material-icons">error</i>
      {{ error }}
      <button type="button" class="btn-close" (click)="error = null"></button>
    </div>
  }

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card pending">
      <div class="stat-icon">
        <i class="material-icons">pending_actions</i>
      </div>
      <div class="stat-content">
        <h3>{{ statistics.pending }}</h3>
        <p>Pending Requests</p>
      </div>
    </div>
    <div class="stat-card approved">
      <div class="stat-icon">
        <i class="material-icons">check_circle</i>
      </div>
      <div class="stat-content">
        <h3>{{ statistics.approved }}</h3>
        <p>Approved Today</p>
      </div>
    </div>
    <div class="stat-card rejected">
      <div class="stat-icon">
        <i class="material-icons">cancel</i>
      </div>
      <div class="stat-content">
        <h3>{{ statistics.rejected }}</h3>
        <p>Rejected Today</p>
      </div>
    </div>
    <div class="stat-card total">
      <div class="stat-icon">
        <i class="material-icons">assignment</i>
      </div>
      <div class="stat-content">
        <h3>{{ statistics.total }}</h3>
        <p>Total Requests</p>
      </div>
    </div>
  </div>

  <!-- Filters and search -->
  <div class="filters-section">
    <div class="filter-group search-group">
      <label for="search">Search</label>
      <div class="search-input">
        <i class="material-icons">search</i>
        <input id="search" class="form-control" type="text" [(ngModel)]="searchQuery" (input)="applyAll()" placeholder="Search by ID, requester, project, or machine type" />
      </div>
    </div>

    <div class="filter-group">
      <label for="statusFilter">Status</label>
      <select id="statusFilter" class="form-select" [(ngModel)]="selectedStatus" (change)="applyAll()">
        <option value="ALL">All Status</option>
        <option value="PENDING">Pending</option>
        <option value="APPROVED">Approved</option>
        <option value="REJECTED">Rejected</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="urgencyFilter">Urgency</label>
      <select id="urgencyFilter" class="form-select" [(ngModel)]="selectedUrgency" (change)="applyAll()">
        <option value="ALL">All Urgency</option>
        <option value="LOW">Low</option>
        <option value="MEDIUM">Medium</option>
        <option value="HIGH">High</option>
        <option value="URGENT">Urgent</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="machineTypeFilter">Machine Type</label>
      <select id="machineTypeFilter" class="form-select" [(ngModel)]="selectedMachineType" (change)="applyAll()">
        <option value="ALL">All Types</option>
        <option value="EXCAVATOR">Excavator</option>
        <option value="BULLDOZER">Bulldozer</option>
        <option value="LOADER">Loader</option>
        <option value="DUMP_TRUCK">Dump Truck</option>
        <option value="DRILL_RIG">Drill Rig</option>
        <option value="CRANE">Crane</option>
      </select>
    </div>

    <div class="filter-actions">
      <button class="btn btn-light" (click)="clearFilters()">
        <i class="material-icons">filter_alt_off</i>
        Clear Filters
      </button>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading-container">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p>Loading assignment requests...</p>
    </div>
  }

  <!-- Requests Table -->
  @if (!isLoading && filteredRequests.length > 0) {
    <div class="requests-table-container">
      <table class="table table-hover">
        <thead>
          <tr>
            <th (click)="setSort('requestedAt')" class="sortable">Requested<span class="sort-caret" [class.active]="sortBy==='requestedAt'">{{ sortDirection==='asc' ? '▲' : '▼' }}</span></th>
            <th (click)="setSort('id')">Request ID</th>
            <th (click)="setSort('requesterName')" class="sortable">Requester<span class="sort-caret" [class.active]="sortBy==='requesterName'">{{ sortDirection==='asc' ? '▲' : '▼' }}</span></th>
            <th (click)="setSort('projectName')" class="sortable">Project<span class="sort-caret" [class.active]="sortBy==='projectName'">{{ sortDirection==='asc' ? '▲' : '▼' }}</span></th>
            <th (click)="setSort('machineType')" class="sortable">Machine Type<span class="sort-caret" [class.active]="sortBy==='machineType'">{{ sortDirection==='asc' ? '▲' : '▼' }}</span></th>
            <th>Quantity</th>
            <th (click)="setSort('urgency')" class="sortable">Urgency<span class="sort-caret" [class.active]="sortBy==='urgency'">{{ sortDirection==='asc' ? '▲' : '▼' }}</span></th>
            <th (click)="setSort('status')" class="sortable">Status<span class="sort-caret" [class.active]="sortBy==='status'">{{ sortDirection==='asc' ? '▲' : '▼' }}</span></th>
            <th>Age</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let request of displayedRequests" class="request-row" [ngClass]="getRowClass(request)">
            <td class="requested-date">{{ formatDate(request.requestedAt) }}</td>
            <td class="request-id"><span class="id-badge">{{ request.id }}</span></td>
            <td class="requester-info">
              <div class="requester-details">
                <span class="name">{{ request.requesterName }}</span>
                <small class="email">{{ request.requesterEmail }}</small>
              </div>
            </td>
            <td class="project-info">
              <div class="project-details">
                <span class="project-name">{{ request.projectName }}</span>
                <small class="project-id">ID: {{ request.projectId }}</small>
              </div>
            </td>
            <td class="machine-type"><span class="type-badge">{{ request.machineType }}</span></td>
            <td class="quantity"><span class="quantity-badge">{{ request.quantity }}</span></td>
            <td class="urgency"><span class="urgency-badge" [ngClass]="getUrgencyClass(request.urgency)">{{ request.urgency }}</span></td>
            <td class="status"><span class="status-badge" [ngClass]="getStatusClass(request.status)">{{ request.status }}</span></td>
            <td class="age">{{ getRequestAgeLabel(request) }}</td>
            <td class="actions">
              <div class="action-buttons">
                @if (request.status === 'PENDING') {
                  <button class="btn btn-sm btn-success action-btn" (click)="approveRequest(request)" title="Approve Request">
                    <i class="material-icons">check</i>
                  </button>
                  <button class="btn btn-sm btn-danger action-btn" (click)="rejectRequest(request)" title="Reject Request">
                    <i class="material-icons">close</i>
                  </button>
                }
              </div>
            </td>
          </tr>
        </tbody>
      </table>

    </div>
  }

  <!-- Empty State -->
  @if (!isLoading && filteredRequests.length === 0) {
    <div class="empty-state">
      <div class="empty-icon">
        <i class="material-icons">assignment</i>
      </div>
      <h3>No Assignment Requests</h3>
      <p>There are no machine assignment requests matching your current filters.</p>
    </div>
  }
</div>