<header class="bg-gradient-to-r from-primary to-primary-dark text-white px-6 py-8 rounded-lg shadow-lg mb-6">
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-3xl font-bold">Store Manager Dashboard</h1>
      <div class="mt-2" *ngIf="currentUser">
        <span class="text-lg">{{ getUserWelcomeMessage() }}</span>
        <div class="flex gap-4 mt-1 text-sm opacity-90">
          <span>Role: {{ currentUser.role }}</span>
          <span *ngIf="currentUser.region">Region: {{ currentUser.region }}</span>
        </div>
      </div>
    </div>
    <button
      type="button"
      class="flex items-center gap-2 bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-md transition-all"
      (click)="refreshDashboard()"
      title="Refresh dashboard data">
      <i class="pi pi-refresh"></i>
      <span>Refresh</span>
    </button>
  </div>
</header>

<div class="flex flex-col items-center justify-center py-12" *ngIf="isLoading">
  <i class="pi pi-spin pi-spinner text-4xl text-primary mb-4"></i>
  <p class="text-gray-600">Loading dashboard...</p>
</div>

<div class="space-y-6" *ngIf="!isLoading">
  <!-- Statistics Cards -->
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
    <!-- Add Stock Requests Card -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-blue-500 hover:shadow-xl transition-shadow">
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <p class="text-sm text-gray-600 font-medium uppercase">Add Stock Requests</p>
          <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.pendingAddRequests }}</p>
          <p class="text-sm text-gray-500 mt-2">Pending approval</p>
        </div>
        <div class="bg-blue-100 p-4 rounded-full">
          <i class="pi pi-plus-circle text-2xl text-blue-600"></i>
        </div>
      </div>
    </div>

    <!-- Edit Stock Requests Card -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-yellow-500 hover:shadow-xl transition-shadow">
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <p class="text-sm text-gray-600 font-medium uppercase">Edit Stock Requests</p>
          <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.pendingEditRequests }}</p>
          <p class="text-sm text-gray-500 mt-2">Pending approval</p>
        </div>
        <div class="bg-yellow-100 p-4 rounded-full">
          <i class="pi pi-pencil text-2xl text-yellow-600"></i>
        </div>
      </div>
    </div>

    <!-- Delete Stock Requests Card -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-red-500 hover:shadow-xl transition-shadow">
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <p class="text-sm text-gray-600 font-medium uppercase">Delete Stock Requests</p>
          <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.pendingDeleteRequests }}</p>
          <p class="text-sm text-gray-500 mt-2">Pending approval</p>
        </div>
        <div class="bg-red-100 p-4 rounded-full">
          <i class="pi pi-trash text-2xl text-red-600"></i>
        </div>
      </div>
    </div>

    <!-- Notifications Card -->
    <div class="bg-white rounded-lg shadow-md p-6 border-l-4 border-purple-500 hover:shadow-xl transition-shadow">
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <p class="text-sm text-gray-600 font-medium uppercase">Notifications</p>
          <p class="text-3xl font-bold text-gray-800 mt-2">{{ stats.totalNotifications }}</p>
          <p class="text-sm text-red-600 mt-2">{{ stats.rejectedRequests }} rejection(s)</p>
        </div>
        <div class="bg-purple-100 p-4 rounded-full">
          <i class="pi pi-bell text-2xl text-purple-600"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- System Metrics Panel -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
      <i class="pi pi-chart-bar text-primary"></i>
      System Overview
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
        <span class="text-sm text-gray-600 flex items-center gap-2">
          <i class="pi pi-check-circle text-green-600"></i>
          Request Approval Rate:
        </span>
        <span class="font-bold text-gray-800">{{ systemMetrics.requestApprovalRate }}</span>
      </div>
      <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
        <span class="text-sm text-gray-600 flex items-center gap-2">
          <i class="pi pi-clock text-blue-600"></i>
          Avg. Response Time:
        </span>
        <span class="font-bold text-gray-800">{{ systemMetrics.averageResponseTime }}</span>
      </div>
      <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
        <span class="text-sm text-gray-600 flex items-center gap-2">
          <i class="pi pi-truck text-purple-600"></i>
          Dispatch Efficiency:
        </span>
        <span class="font-bold text-green-600">{{ systemMetrics.dispatchEfficiency }}</span>
      </div>
      <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
        <span class="text-sm text-gray-600 flex items-center gap-2">
          <i class="pi pi-envelope text-indigo-600"></i>
          Notification Status:
        </span>
        <span class="font-bold text-gray-800">{{ systemMetrics.notificationStatus }}</span>
      </div>
      <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
        <span class="text-sm text-gray-600 flex items-center gap-2">
          <i class="pi pi-refresh text-orange-600"></i>
          Last Stock Update:
        </span>
        <span class="font-bold text-gray-800">{{ systemMetrics.lastStockUpdate }}</span>
      </div>
      <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
        <span class="text-sm text-gray-600 flex items-center gap-2">
          <i class="pi pi-box text-teal-600"></i>
          Total Batches:
        </span>
        <span class="font-bold text-gray-800">{{ systemMetrics.totalBatches }}</span>
      </div>
    </div>
  </div>

  <!-- Quick Actions Panel -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
      <i class="pi pi-th-large text-primary"></i>
      Quick Actions
    </h3>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      <!-- Add Stock Request Action -->
      <div
        class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 cursor-pointer hover:shadow-lg transition-all hover:-translate-y-1 border-l-4 border-blue-500"
        (click)="navigateToAddStock()">
        <div class="flex items-center gap-4">
          <div class="bg-blue-500 p-4 rounded-full">
            <i class="pi pi-plus-circle text-2xl text-white"></i>
          </div>
          <div class="flex-1">
            <h4 class="text-lg font-semibold text-gray-800">Add Stock Request</h4>
            <p class="text-sm text-gray-600 mt-1">Submit request to add new explosive stock entries</p>
            <div class="mt-2 text-sm font-medium text-blue-700">{{ stats.pendingAddRequests }} pending</div>
          </div>
        </div>
      </div>

      <!-- Edit Stock Request Action -->
      <div
        class="bg-gradient-to-br from-yellow-50 to-yellow-100 rounded-lg p-6 cursor-pointer hover:shadow-lg transition-all hover:-translate-y-1 border-l-4 border-yellow-500"
        (click)="navigateToEditStock()">
        <div class="flex items-center gap-4">
          <div class="bg-yellow-500 p-4 rounded-full">
            <i class="pi pi-pencil text-2xl text-white"></i>
          </div>
          <div class="flex-1">
            <h4 class="text-lg font-semibold text-gray-800">Edit Stock Request</h4>
            <p class="text-sm text-gray-600 mt-1">Submit request to edit existing explosive stock entries</p>
            <div class="mt-2 text-sm font-medium text-yellow-700">{{ stats.pendingEditRequests }} pending</div>
          </div>
        </div>
      </div>

      <!-- Delete Stock Request Action -->
      <div
        class="bg-gradient-to-br from-red-50 to-red-100 rounded-lg p-6 cursor-pointer hover:shadow-lg transition-all hover:-translate-y-1 border-l-4 border-red-500"
        (click)="navigateToDeleteStock()">
        <div class="flex items-center gap-4">
          <div class="bg-red-500 p-4 rounded-full">
            <i class="pi pi-trash text-2xl text-white"></i>
          </div>
          <div class="flex-1">
            <h4 class="text-lg font-semibold text-gray-800">Delete Stock Request</h4>
            <p class="text-sm text-gray-600 mt-1">Submit request to delete explosive stock entries</p>
            <div class="mt-2 text-sm font-medium text-red-700">{{ stats.pendingDeleteRequests }} pending</div>
          </div>
        </div>
      </div>

      <!-- Notifications Action -->
      <div
        class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-6 cursor-pointer hover:shadow-lg transition-all hover:-translate-y-1 border-l-4 border-purple-500"
        (click)="navigateToNotifications()">
        <div class="flex items-center gap-4">
          <div class="bg-purple-500 p-4 rounded-full">
            <i class="pi pi-bell text-2xl text-white"></i>
          </div>
          <div class="flex-1">
            <h4 class="text-lg font-semibold text-gray-800">Notifications</h4>
            <p class="text-sm text-gray-600 mt-1">View rejection notifications and store updates</p>
            <div class="mt-2 text-sm font-medium text-purple-700">{{ stats.totalNotifications }} notifications</div>
          </div>
        </div>
      </div>

      <!-- Dispatch Preparation Action -->
      <div
        class="bg-gradient-to-br from-green-50 to-green-100 rounded-lg p-6 cursor-pointer hover:shadow-lg transition-all hover:-translate-y-1 border-l-4 border-green-500"
        (click)="navigateToDispatch()">
        <div class="flex items-center gap-4">
          <div class="bg-green-500 p-4 rounded-full">
            <i class="pi pi-truck text-2xl text-white"></i>
          </div>
          <div class="flex-1">
            <h4 class="text-lg font-semibold text-gray-800">Dispatch Preparation</h4>
            <p class="text-sm text-gray-600 mt-1">Prepare explosives for dispatch when notified</p>
            <div class="mt-2 text-sm font-medium text-green-700">{{ stats.dispatchOrders }} orders</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- User Profile Section -->
  <div class="bg-white rounded-lg shadow-md p-6">
    <h3 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
      <i class="pi pi-user text-primary"></i>
      Store Manager Profile
    </h3>
    <div *ngIf="currentUser">
      <!-- Profile Header -->
      <div class="flex items-start gap-6 mb-6 pb-6 border-b border-gray-200">
        <div class="flex-shrink-0">
          <div class="w-24 h-24 rounded-full bg-gradient-to-br from-primary to-primary-dark flex items-center justify-center text-white text-3xl font-bold shadow-lg">
            {{ getInitials() }}
          </div>
        </div>
        <div class="flex-1">
          <h4 class="text-2xl font-bold text-gray-800">{{ currentUser.name }}</h4>
          <p class="text-gray-600 mt-1 flex items-center gap-2">
            <i class="pi pi-envelope text-sm"></i>
            {{ currentUser.email }}
          </p>
          <div class="mt-3">
            <span class="inline-block px-4 py-1.5 bg-blue-100 text-blue-800 rounded-full text-sm font-medium">
              <i class="pi pi-briefcase mr-1"></i>
              Store Manager
            </span>
          </div>
        </div>
      </div>

      <!-- Profile Details Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        <div class="bg-gray-50 rounded-lg p-4">
          <div class="flex items-center gap-2 text-sm text-gray-600 mb-2">
            <i class="pi pi-star"></i>
            <span class="font-medium">Specialization</span>
          </div>
          <div class="text-gray-800 font-semibold">Store Management</div>
        </div>

        <div class="bg-gray-50 rounded-lg p-4">
          <div class="flex items-center gap-2 text-sm text-gray-600 mb-2">
            <i class="pi pi-map-marker"></i>
            <span class="font-medium">Operating Region</span>
          </div>
          <div class="text-gray-800 font-semibold">{{ currentUser.region || 'All Regions' }}</div>
        </div>

        <div class="bg-gray-50 rounded-lg p-4">
          <div class="flex items-center gap-2 text-sm text-gray-600 mb-2">
            <i class="pi pi-globe"></i>
            <span class="font-medium">Country</span>
          </div>
          <div class="text-gray-800 font-semibold">{{ currentUser.country || 'Oman' }}</div>
        </div>

        <div class="bg-gray-50 rounded-lg p-4">
          <div class="flex items-center gap-2 text-sm text-gray-600 mb-2">
            <i class="pi pi-phone"></i>
            <span class="font-medium">Contact</span>
          </div>
          <div class="text-gray-800 font-semibold">{{ currentUser.omanPhone || currentUser.countryPhone || 'Not provided' }}</div>
        </div>

        <div class="bg-gray-50 rounded-lg p-4">
          <div class="flex items-center gap-2 text-sm text-gray-600 mb-2">
            <i class="pi pi-info-circle"></i>
            <span class="font-medium">Status</span>
          </div>
          <div>
            <span
              class="inline-block px-3 py-1 rounded-full text-sm font-medium"
              [ngClass]="{
                'bg-green-100 text-green-800': (currentUser.status || 'active').toLowerCase() === 'active',
                'bg-yellow-100 text-yellow-800': (currentUser.status || 'active').toLowerCase() === 'pending',
                'bg-red-100 text-red-800': (currentUser.status || 'active').toLowerCase() === 'inactive'
              }">
              {{ currentUser.status || 'ACTIVE' }}
            </span>
          </div>
        </div>

        <div class="bg-gray-50 rounded-lg p-4">
          <div class="flex items-center gap-2 text-sm text-gray-600 mb-2">
            <i class="pi pi-database"></i>
            <span class="font-medium">Requests Managed</span>
          </div>
          <div class="text-gray-800 font-semibold">{{ stats.totalNotifications }} requests</div>
        </div>
      </div>
    </div>
  </div>

</div>
