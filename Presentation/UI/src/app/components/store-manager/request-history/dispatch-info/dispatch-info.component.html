<div class="dispatch-info-container" *ngIf="request && !isLoading">
  <!-- Header Section -->
  <div class="dispatch-header">
    <div class="header-content">
      <div class="icon-wrapper">
        <mat-icon>local_shipping</mat-icon>
      </div>
      <div class="header-text">
        <h3>Dispatch Information</h3>
        <div class="subtitle">Request Number: {{ request.requestNumber }}</div>
      </div>
    </div>
    <div class="status-badge" [ngClass]="getDispatchStatusClass()">
      <mat-icon>local_shipping</mat-icon>
      {{ getDispatchStatus() }}
    </div>
    <button class="close-btn" (click)="onClose()" *ngIf="!isStandalonePage">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <!-- Dispatch Details -->
  <div class="dispatch-details">
    <div class="details-grid">
      <!-- Timeline Section -->
      <div class="detail-card">
        <div class="card-header">
          <mat-icon>schedule</mat-icon>
          Dispatch Timeline
        </div>
        <div class="card-content">
          <div class="detail-item">
            <label>Request Date:</label>
            <span class="value">{{ formatDate(request.requestDate) }}</span>
          </div>
          <div class="detail-item">
            <label>Required Date:</label>
            <span class="value">{{ formatDate(request.requiredByDate) }}</span>
          </div>
          <div class="detail-item">
            <label>Dispatch Date:</label>
            <span class="value">{{ formatDate(request.dispatchDate) }}</span>
          </div>
          <div class="detail-item" *ngIf="request.deliveryConfirmedDate">
            <label>Delivery Confirmed:</label>
            <span class="value">{{ formatDate(request.deliveryConfirmedDate) }}</span>
          </div>
        </div>
      </div>

      <!-- Requester Information -->
      <div class="detail-card">
        <div class="card-header">
          <mat-icon>person</mat-icon>
          Requester Information
        </div>
        <div class="card-content">
          <div class="detail-item">
            <label>Requester Name:</label>
            <span class="value">{{ request.requestedByUserName }}</span>
          </div>
          <div class="detail-item">
            <label>Destination Store:</label>
            <span class="value">{{ request.destinationStoreName }}</span>
          </div>
          <div class="detail-item">
            <label>Batch ID:</label>
            <span class="value">{{ request.batchId }}</span>
          </div>
        </div>
      </div>

      <!-- Transportation Information -->
      <div class="detail-card">
        <div class="card-header">
          <mat-icon>local_shipping</mat-icon>
          Transportation Details
        </div>
        <div class="card-content">
          <div class="detail-item">
            <label>Truck Number:</label>
            <span class="value">{{ request.truckNumber || 'N/A' }}</span>
          </div>
          <div class="detail-item">
            <label>Driver Name:</label>
            <span class="value">{{ request.driverName || 'N/A' }}</span>
          </div>
          <div class="detail-item" *ngIf="request.driverContactNumber">
            <label>Driver Contact:</label>
            <span class="value">{{ request.driverContactNumber }}</span>
          </div>
          <div class="detail-item">
            <label>Dispatched By:</label>
            <span class="value">{{ request.dispatchedByUserName || 'N/A' }}</span>
          </div>
        </div>
      </div>

      <!-- Items Summary -->
      <div class="detail-card full-width">
        <div class="card-header">
          <mat-icon>inventory</mat-icon>
          Dispatched Items
        </div>
        <div class="card-content">
          <div class="items-table">
            <div class="table-header">
              <div>Explosive Type</div>
              <div>Requested Quantity</div>
              <div>Approved Quantity</div>
              <div>Final Quantity</div>
              <div>Unit</div>
            </div>
            <div class="table-row">
              <div class="item-type">{{ request.explosiveTypeName }}</div>
              <div class="item-quantity">{{ request.requestedQuantity }}</div>
              <div class="item-quantity">{{ request.approvedQuantity || '-' }}</div>
              <div class="item-quantity"><strong>{{ request.finalQuantity }}</strong></div>
              <div class="item-unit">{{ request.unit }}</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Additional Information -->
    <div class="info-section">
      <div class="section-header">
        <mat-icon>info</mat-icon>
        Additional Information
      </div>
      <div class="section-content">
        <div class="info-item" *ngIf="request.requestNotes">
          <strong>Request Notes:</strong>
          <span class="value">{{ request.requestNotes }}</span>
        </div>
        <div class="info-item" *ngIf="request.approvalNotes">
          <strong>Approval Notes:</strong>
          <span class="value">{{ request.approvalNotes }}</span>
        </div>
        <div class="info-item" *ngIf="request.dispatchNotes">
          <strong>Dispatch Notes:</strong>
          <span class="value">{{ request.dispatchNotes }}</span>
        </div>
        <div class="info-item" *ngIf="!request.requestNotes && !request.approvalNotes && !request.dispatchNotes">
          <span class="value">No additional notes</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Action Section -->
  <div class="action-section">
    <div class="action-info" *ngIf="canConfirmDelivery()">
      <mat-icon>info</mat-icon>
      <span>Materials ready for collection - Confirm when received</span>
    </div>
    <div class="action-info" *ngIf="request.deliveryConfirmedDate">
      <mat-icon>check_circle</mat-icon>
      <span>Delivery confirmed on {{ formatDate(request.deliveryConfirmedDate) }}</span>
    </div>
    <div class="action-buttons">
      <button class="receive-btn" (click)="onReceive()" *ngIf="canConfirmDelivery()" [disabled]="isLoading">
        <mat-icon>check_circle</mat-icon>
        {{ isLoading ? 'Processing...' : 'Confirm Receipt' }}
      </button>
      <button class="back-btn" (click)="onClose()" *ngIf="isStandalonePage">
        <mat-icon>arrow_back</mat-icon>
        Back to Request History
      </button>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-state" *ngIf="isLoading">
  <mat-icon>hourglass_empty</mat-icon>
  <h4>Loading dispatch information...</h4>
</div>

<!-- Empty State -->
<div class="no-request" *ngIf="!request && !isStandalonePage && !isLoading">
  <div class="empty-state">
    <mat-icon>local_shipping</mat-icon>
    <h4>No Request Selected</h4>
    <p>Select a dispatched request to view dispatch information</p>
  </div>
</div>

<!-- Not Dispatched State -->
<div class="not-dispatched" *ngIf="request && !request.dispatchDate && !isLoading">
  <div class="empty-state">
    <mat-icon>schedule</mat-icon>
    <h4>Request Not Yet Dispatched</h4>
    <p>This request has not been dispatched yet. Dispatch information will be available once the request is processed.</p>
    <button class="back-btn" (click)="onClose()">
      <mat-icon>arrow_back</mat-icon>
      Back
    </button>
  </div>
</div>
