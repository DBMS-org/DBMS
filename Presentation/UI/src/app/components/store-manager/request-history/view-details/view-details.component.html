<div class="modal-overlay" *ngIf="request" (click)="onBackdropClick($event)">
  <div class="modal-container">
    <!-- Modal Header -->
    <div class="modal-header">
      <h2 class="modal-title">
        <i class="material-icons">description</i>
        Request Details
      </h2>
      <button class="btn-close" (click)="onClose()">
        <i class="material-icons">close</i>
      </button>
    </div>

    <!-- Modal Content -->
    <div class="modal-content" *ngIf="request">

      <!-- Request Information Section -->
      <div class="info-section">
        <h3 class="section-title">
          <i class="material-icons">info</i>
          Request Information
        </h3>
        <div class="info-grid">
          <div class="info-item">
            <label>Request Number:</label>
            <span class="value">{{ request?.requestNumber }}</span>
          </div>
          <div class="info-item">
            <label>Request Date:</label>
            <span class="value">{{ formatDate(request?.requestDate) }}</span>
          </div>
          <div class="info-item">
            <label>Required Date:</label>
            <span class="value">{{ formatDate(request?.requiredByDate) }}</span>
          </div>
          <div class="info-item">
            <label>Status:</label>
            <span class="badge" [class]="getStatusClass(request?.statusName || '')">
              {{ request?.statusName }}
            </span>
          </div>
        </div>
      </div>

      <!-- Requester Information Section -->
      <div class="info-section">
        <h3 class="section-title">
          <i class="material-icons">person</i>
          Requester Information
        </h3>
        <div class="info-grid">
          <div class="info-item">
            <label>Requester Name:</label>
            <span class="value">{{ request?.requestedByUserName }}</span>
          </div>
          <div class="info-item">
            <label>Destination Store:</label>
            <span class="value">{{ request?.destinationStoreName }}</span>
          </div>
        </div>
      </div>

      <!-- Explosive Details Section -->
      <div class="info-section">
        <h3 class="section-title">
          <i class="material-icons">science</i>
          Explosive Details
        </h3>
        <div class="info-grid">
          <div class="info-item">
            <label>Explosive Type:</label>
            <span class="value">{{ request?.explosiveTypeName }}</span>
          </div>
          <div class="info-item">
            <label>Requested Quantity:</label>
            <span class="value">{{ request?.requestedQuantity }} {{ request?.unit }}</span>
          </div>
          <div class="info-item">
            <label>Approved Quantity:</label>
            <span class="value">{{ request?.approvedQuantity || '-' }} {{ request?.approvedQuantity ? request?.unit : '' }}</span>
          </div>
          <div class="info-item">
            <label>Final Quantity:</label>
            <span class="value">{{ request?.finalQuantity }} {{ request?.unit }}</span>
          </div>
        </div>
      </div>

      <!-- Approval Information Section -->
      <div class="info-section" *ngIf="request?.approvedDate">
        <h3 class="section-title">
          <i class="material-icons">verified</i>
          Approval Information
        </h3>
        <div class="info-grid">
          <div class="info-item">
            <label>Approval Date:</label>
            <span class="value">{{ request?.approvedDate ? formatDate(request.approvedDate) : 'Not yet approved' }}</span>
          </div>
          <div class="info-item">
            <label>Approved By:</label>
            <span class="value">{{ request?.approvedByUserName || '-' }}</span>
          </div>
          <div class="info-item" *ngIf="request?.deliveryConfirmedDate">
            <label>Delivery Confirmed:</label>
            <span class="value">{{ request?.deliveryConfirmedDate ? formatDate(request.deliveryConfirmedDate) : 'Not yet fulfilled' }}</span>
          </div>
          <div class="info-item" *ngIf="request?.rejectionReason">
            <label>Rejection Reason:</label>
            <span class="value text-danger">{{ request?.rejectionReason }}</span>
          </div>
        </div>
      </div>

      <!-- Dispatch Information Section -->
      <div class="info-section" *ngIf="request?.dispatchDate">
        <h3 class="section-title">
          <i class="material-icons">local_shipping</i>
          Dispatch Information
        </h3>
        <div class="info-grid">
          <div class="info-item">
            <label>Dispatch Date:</label>
            <span class="value">{{ formatDate(request?.dispatchDate) }}</span>
          </div>
          <div class="info-item">
            <label>Truck Number:</label>
            <span class="value">{{ request?.truckNumber || '-' }}</span>
          </div>
          <div class="info-item">
            <label>Driver Name:</label>
            <span class="value">{{ request?.driverName || '-' }}</span>
          </div>
          <div class="info-item">
            <label>Driver Contact:</label>
            <span class="value">{{ request?.driverContactNumber || '-' }}</span>
          </div>
        </div>
      </div>

      <!-- Notes Section -->
      <div class="info-section">
        <h3 class="section-title">
          <i class="material-icons">note</i>
          Notes
        </h3>
        <div class="notes-content">
          <p>{{ request?.requestNotes || 'No additional notes provided.' }}</p>
        </div>
        <div class="notes-content" *ngIf="request?.approvalNotes">
          <strong>Approval Notes:</strong>
          <p>{{ request?.approvalNotes }}</p>
        </div>
        <div class="notes-content" *ngIf="request?.dispatchNotes">
          <strong>Dispatch Notes:</strong>
          <p>{{ request?.dispatchNotes }}</p>
        </div>
      </div>

    </div>

    <!-- Modal Footer -->
    <div class="modal-footer">
      <button class="btn btn-secondary" (click)="onClose()">
        Close
      </button>
    </div>
  </div>
</div>
