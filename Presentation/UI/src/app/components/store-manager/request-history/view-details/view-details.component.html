<p-dialog
  [(visible)]="isVisible"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  [style]="{width: '90vw', maxWidth: '900px'}"
  styleClass="request-details-dialog"
  (onHide)="onClose()">

  <ng-template pTemplate="header">
    <div class="flex items-center gap-2 p-2">
      <i class="pi pi-file text-lg text-indigo-600"></i>
      <h2 class="text-lg font-bold text-gray-800 m-0">Request Details</h2>
    </div>
  </ng-template>

  <div *ngIf="request" class="p-3">

      <!-- Request Information Section -->
      <p-panel [toggleable]="true" styleClass="mb-3">
        <ng-template pTemplate="header">
          <div class="flex items-center gap-2 p-2">
            <i class="pi pi-info-circle text-indigo-600 text-sm"></i>
            <span class="font-semibold text-sm">Request Information</span>
          </div>
        </ng-template>
        <div class="p-3 grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="flex justify-between items-center py-1.5 border-b border-gray-100">
            <label class="text-xs font-medium text-gray-500">Request Number:</label>
            <span class="text-sm text-gray-800 font-semibold">{{ request?.requestNumber }}</span>
          </div>
          <div class="flex justify-between items-center py-1.5 border-b border-gray-100">
            <label class="text-xs font-medium text-gray-500">Request Date:</label>
            <span class="text-sm text-gray-800">{{ formatDate(request?.requestDate) }}</span>
          </div>
          <div class="flex justify-between items-center py-1.5 border-b border-gray-100">
            <label class="text-xs font-medium text-gray-500">Required Date:</label>
            <span class="text-sm text-gray-800">{{ formatDate(request?.requiredByDate) }}</span>
          </div>
          <div class="flex justify-between items-center py-1.5">
            <label class="text-xs font-medium text-gray-500">Status:</label>
            <p-tag [value]="request?.statusName" [severity]="getTagSeverity(request?.statusName || '')" styleClass="text-xs"></p-tag>
          </div>
        </div>
      </p-panel>

      <!-- Requester Information Section -->
      <p-panel [toggleable]="true" styleClass="mb-3">
        <ng-template pTemplate="header">
          <div class="flex items-center gap-2 p-2">
            <i class="pi pi-user text-indigo-600 text-sm"></i>
            <span class="font-semibold text-sm">Requester Information</span>
          </div>
        </ng-template>
        <div class="p-3 grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="flex justify-between items-center py-1.5 border-b border-gray-100">
            <label class="text-xs font-medium text-gray-500">Requester Name:</label>
            <span class="text-sm text-gray-800">{{ request?.requestedByUserName }}</span>
          </div>
          <div class="flex justify-between items-center py-1.5">
            <label class="text-xs font-medium text-gray-500">Destination Store:</label>
            <span class="text-sm text-gray-800">{{ request?.destinationStoreName }}</span>
          </div>
        </div>
      </p-panel>

      <!-- Explosive Details Section -->
      <p-panel [toggleable]="true" styleClass="mb-3">
        <ng-template pTemplate="header">
          <div class="flex items-center gap-2 p-2">
            <i class="pi pi-box text-indigo-600 text-sm"></i>
            <span class="font-semibold text-sm">Explosive Details</span>
          </div>
        </ng-template>
        <div class="p-3 grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="flex justify-between items-center py-1.5 border-b border-gray-100">
            <label class="text-xs font-medium text-gray-500">Explosive Type:</label>
            <span class="text-sm text-gray-800 font-semibold">{{ request?.explosiveTypeName }}</span>
          </div>
          <div class="flex justify-between items-center py-1.5 border-b border-gray-100">
            <label class="text-xs font-medium text-gray-500">Requested Quantity:</label>
            <span class="text-sm text-gray-800 font-semibold">{{ request?.requestedQuantity }} {{ request?.unit }}</span>
          </div>
          <div class="flex justify-between items-center py-1.5 border-b border-gray-100">
            <label class="text-xs font-medium text-gray-500">Approved Quantity:</label>
            <span class="text-sm text-gray-800 font-semibold">{{ request?.approvedQuantity || '-' }} {{ request?.approvedQuantity ? request?.unit : '' }}</span>
          </div>
          <div class="flex justify-between items-center py-1.5">
            <label class="text-xs font-medium text-gray-500">Final Quantity:</label>
            <span class="text-sm text-green-600 font-bold">{{ request?.finalQuantity }} {{ request?.unit }}</span>
          </div>
        </div>
      </p-panel>

      <!-- Approval Information Section -->
      <p-panel *ngIf="request?.approvedDate" [toggleable]="true" styleClass="mb-3">
        <ng-template pTemplate="header">
          <div class="flex items-center gap-2 p-2">
            <i class="pi pi-check-circle text-indigo-600 text-sm"></i>
            <span class="font-semibold text-sm">Approval Information</span>
          </div>
        </ng-template>
        <div class="p-3 grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="flex justify-between items-center py-1.5 border-b border-gray-100">
            <label class="text-xs font-medium text-gray-500">Approval Date:</label>
            <span class="text-sm text-gray-800">{{ request?.approvedDate ? formatDate(request.approvedDate) : 'Not yet approved' }}</span>
          </div>
          <div class="flex justify-between items-center py-1.5 border-b border-gray-100">
            <label class="text-xs font-medium text-gray-500">Approved By:</label>
            <span class="text-sm text-gray-800">{{ request?.approvedByUserName || '-' }}</span>
          </div>
          <div class="flex justify-between items-center py-1.5" *ngIf="request?.deliveryConfirmedDate">
            <label class="text-xs font-medium text-gray-500">Delivery Confirmed:</label>
            <span class="text-sm text-green-600 font-semibold">{{ request?.deliveryConfirmedDate ? formatDate(request.deliveryConfirmedDate) : 'Not yet fulfilled' }}</span>
          </div>
          <div class="md:col-span-2" *ngIf="request?.rejectionReason">
            <div class="p-2.5 bg-red-50 rounded border-l-4 border-red-500">
              <strong class="text-red-800 text-xs">Rejection Reason:</strong>
              <p class="m-0 mt-1 text-xs text-red-600">{{ request?.rejectionReason }}</p>
            </div>
          </div>
        </div>
      </p-panel>

      <!-- Dispatch Information Section -->
      <p-panel *ngIf="request?.dispatchDate" [toggleable]="true" styleClass="mb-3">
        <ng-template pTemplate="header">
          <div class="flex items-center gap-2 p-2">
            <i class="pi pi-truck text-indigo-600 text-sm"></i>
            <span class="font-semibold text-sm">Dispatch Information</span>
          </div>
        </ng-template>
        <div class="p-3 grid grid-cols-1 md:grid-cols-2 gap-3">
          <div class="flex justify-between items-center py-1.5 border-b border-gray-100">
            <label class="text-xs font-medium text-gray-500">Dispatch Date:</label>
            <span class="text-sm text-gray-800">{{ formatDate(request?.dispatchDate) }}</span>
          </div>
          <div class="flex justify-between items-center py-1.5 border-b border-gray-100">
            <label class="text-xs font-medium text-gray-500">Truck Number:</label>
            <span class="text-sm text-gray-800">{{ request?.truckNumber || '-' }}</span>
          </div>
          <div class="flex justify-between items-center py-1.5 border-b border-gray-100">
            <label class="text-xs font-medium text-gray-500">Driver Name:</label>
            <span class="text-sm text-gray-800">{{ request?.driverName || '-' }}</span>
          </div>
          <div class="flex justify-between items-center py-1.5">
            <label class="text-xs font-medium text-gray-500">Driver Contact:</label>
            <span class="text-sm text-gray-800">{{ request?.driverContactNumber || '-' }}</span>
          </div>
        </div>
      </p-panel>

      <!-- Notes Section -->
      <p-panel [toggleable]="true">
        <ng-template pTemplate="header">
          <div class="flex items-center gap-2 p-2">
            <i class="pi pi-comment text-indigo-600 text-sm"></i>
            <span class="font-semibold text-sm">Notes</span>
          </div>
        </ng-template>
        <div class="p-3 space-y-2">
          <div *ngIf="request?.requestNotes" class="p-2.5 bg-blue-50 rounded border-l-4 border-blue-500">
            <strong class="text-blue-800 text-xs">Request Notes:</strong>
            <p class="m-0 mt-1 text-xs text-gray-700">{{ request?.requestNotes }}</p>
          </div>
          <div *ngIf="request?.approvalNotes" class="p-2.5 bg-green-50 rounded border-l-4 border-green-500">
            <strong class="text-green-800 text-xs">Approval Notes:</strong>
            <p class="m-0 mt-1 text-xs text-gray-700">{{ request?.approvalNotes }}</p>
          </div>
          <div *ngIf="request?.dispatchNotes" class="p-2.5 bg-indigo-50 rounded border-l-4 border-indigo-500">
            <strong class="text-indigo-800 text-xs">Dispatch Notes:</strong>
            <p class="m-0 mt-1 text-xs text-gray-700">{{ request?.dispatchNotes }}</p>
          </div>
          <div *ngIf="!request?.requestNotes && !request?.approvalNotes && !request?.dispatchNotes" class="p-2.5 bg-gray-50 rounded text-center">
            <span class="text-gray-500 italic text-xs">No additional notes provided.</span>
          </div>
        </div>
      </p-panel>

  </div>

  <ng-template pTemplate="footer">
    <p-button
      label="Close"
      icon="pi pi-times"
      (onClick)="onClose()"
      severity="secondary"></p-button>
  </ng-template>
</p-dialog>
