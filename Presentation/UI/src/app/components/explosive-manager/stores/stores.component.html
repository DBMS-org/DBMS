<div class="stores-container">
  <!-- Header Section -->
  <div class="header-section">
    <h2 class="page-title">Store Management</h2>
    <div class="header-actions">
      <button 
        class="btn btn-primary add-btn"
        (click)="openAddStoreModal()"
        [disabled]="isLoading">
        <i class="material-icons">add</i>
        New Store
      </button>
    </div>
  </div>

  <!-- Error Alert -->
  @if (errorMessage) {
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <i class="material-icons">error</i>
      {{ errorMessage }}
      <button type="button" class="btn-close" (click)="errorMessage = ''" title="Close error message" aria-label="Close error message"></button>
    </div>
  }

  <!-- Success Alert -->
  @if (successMessage) {
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      <i class="material-icons">check_circle</i>
      {{ successMessage }}
      <button type="button" class="btn-close" (click)="successMessage = ''" title="Close success message" aria-label="Close success message"></button>
    </div>
  }

  <!-- Statistics Component -->
  <app-store-statistics [statistics]="statistics"></app-store-statistics>

  <!-- Filters Component -->
  <app-store-filters 
    [filters]="filters"
    [storeStatuses]="storeStatuses"
    [uniqueLocations]="uniqueLocations"
    [uniqueManagers]="uniqueManagers"
    (filtersChange)="onFilterChange()"
    (searchChange)="onSearchChange()"
    (clearFilters)="clearFilters()">
  </app-store-filters>

  <!-- Store List Component -->
  <app-store-list 
    [stores]="filteredStores"
    [isLoading]="isLoading"
    (viewStore)="openViewStoreModal($event)"
    (editStore)="openEditStoreModal($event)"
    (deactivateStore)="openDeactivateConfirmModal($event)"
    (deleteStore)="openDeleteConfirmModal($event)"
    (clearFilters)="clearFilters()"
    (addNewStore)="openAddStoreModal()">
  </app-store-list>
</div>

<!-- Store Form Component for Add -->
<app-store-form
  [isVisible]="showAddStoreModal"
  [isEditMode]="false"
  [store]="null"
  [successMessage]="successMessage"
  [errorMessage]="errorMessage"
  [storeStatuses]="storeStatuses"
  [explosiveTypes]="explosiveTypes"
  [uniqueLocations]="uniqueLocations"
  [uniqueManagers]="uniqueManagers"
  (formSubmit)="onAddStore($event)"
  (formCancel)="closeAllModals()">
</app-store-form>

<!-- Store Form Component for Edit -->
<app-store-form
  [isVisible]="showEditStoreModal"
  [isEditMode]="true"
  [store]="selectedStore"
  [successMessage]="successMessage"
  [errorMessage]="errorMessage"
  [storeStatuses]="storeStatuses"
  [explosiveTypes]="explosiveTypes"
  [uniqueLocations]="uniqueLocations"
  [uniqueManagers]="uniqueManagers"
  (formSubmit)="onEditStore($event)"
  (formCancel)="closeAllModals()">
</app-store-form>

<!-- View Store Modal -->
<div *ngIf="showViewStoreModal && selectedStore" class="modal-overlay" (click)="closeAllModals()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3><i class="fas fa-eye"></i> Store Details</h3>
      <button class="btn-close" (click)="closeAllModals()" title="Close store details" aria-label="Close store details">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <div class="store-details">
        <!-- Basic Information -->
        <div class="details-section">
          <h4><i class="fas fa-info-circle"></i> Basic Information</h4>
          <div class="details-grid">
            <div class="detail-item">
              <label><i class="fas fa-store"></i> Store Name *</label>
              <span>{{ selectedStore.storeName }}</span>
            </div>
            <div class="detail-item full-width">
              <label><i class="fas fa-map-marker-alt"></i> Store Address *</label>
              <span>{{ selectedStore.storeAddress }}</span>
            </div>
          </div>
        </div>

        <!-- Location Information -->
        <div class="details-section">
          <h4><i class="fas fa-map-marked-alt"></i> Location Information</h4>
          <div class="details-grid">
            <div class="detail-item">
              <label><i class="fas fa-city"></i> City *</label>
              <span>{{ selectedStore.city }}</span>
            </div>
            <div class="detail-item">
              <label><i class="fas fa-globe-americas"></i> Region *</label>
              <span>{{ selectedStore.regionId }}</span>
            </div>
          </div>
        </div>

        <!-- Storage Information -->
        <div class="details-section">
          <h4><i class="fas fa-warehouse"></i> Storage Information</h4>
          <div class="details-grid">
            <div class="detail-item">
              <label><i class="fas fa-weight-hanging"></i> Storage Capacity (tons) *</label>
              <span>{{ selectedStore.storageCapacity | number:'1.0-0' }} tons</span>
            </div>
          </div>
        </div>

        <!-- Explosive Types Available -->
        <div class="details-section">
          <h4><i class="fas fa-user-tie"></i> Manager Information</h4>
          <div class="manager-info">
            <p><strong>Manager ID:</strong> {{ selectedStore.managerUserId }}</p>
            <p><strong>Project ID:</strong> {{ selectedStore.projectId }}</p>
          </div>
        </div>

        <!-- Manager Information -->
        <div class="details-section">
          <h4><i class="fas fa-user-tie"></i> Store Manager</h4>
          <div class="details-grid">
            <div class="detail-item">
              <label>Manager Name</label>
              <span>{{ selectedStore.storeManagerName }}</span>
            </div>
            <div class="detail-item">
              <label>Contact</label>
              <span>{{ selectedStore.storeManagerContact }}</span>
            </div>
            <div class="detail-item full-width" *ngIf="selectedStore.storeManagerEmail">
              <label>Email</label>
              <span>{{ selectedStore.storeManagerEmail }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button 
        type="button" 
        class="btn btn-secondary"
        (click)="closeAllModals()">
        Close
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteConfirmModal && selectedStore" class="modal-overlay" (click)="closeAllModals()">
  <div class="modal-content modal-sm" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="text-danger"><i class="fas fa-exclamation-triangle"></i> Confirm Delete</h3>
      <button class="btn-close" (click)="closeAllModals()" title="Close delete confirmation" aria-label="Close delete confirmation">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body text-center">
      <div class="warning-icon">
        <i class="fas fa-trash-alt fa-3x text-danger"></i>
      </div>
      <h4>Delete Store?</h4>
      <p>Are you sure you want to delete <strong>{{ selectedStore.storeName }}</strong>?</p>
      <p class="text-danger"><small>This action will permanently remove the store and all its active inventory records. This cannot be undone.</small></p>
    </div>
    
    <div class="modal-footer">
      <button 
        type="button" 
        class="btn btn-secondary"
        (click)="closeAllModals()">
        Cancel
      </button>
      <button 
        type="button" 
        class="btn btn-danger"
        (click)="onDeleteStore()">
        <i class="fas fa-trash"></i>
        Delete Store
      </button>
    </div>
  </div>
</div>

<!-- Deactivate Confirmation Modal -->
<div *ngIf="showDeactivateConfirmModal && selectedStore" class="modal-overlay" (click)="closeAllModals()">
  <div class="modal-content modal-sm" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 class="text-warning"><i class="fas fa-pause-circle"></i> Confirm Deactivation</h3>
      <button class="btn-close" (click)="closeAllModals()" title="Close deactivation confirmation" aria-label="Close deactivation confirmation">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body text-center">
      <div class="warning-icon">
        <i class="fas fa-pause fa-3x text-warning"></i>
      </div>
      <h4>Deactivate Store?</h4>
      <p>Are you sure you want to deactivate <strong>{{ selectedStore.storeName }}</strong>?</p>
      <p class="text-muted"><small>The store will be marked as inactive but all historical data will be retained. You can reactivate it later if needed.</small></p>
    </div>
    
    <div class="modal-footer">
      <button 
        type="button" 
        class="btn btn-secondary"
        (click)="closeAllModals()">
        Cancel
      </button>
      <button 
        type="button" 
        class="btn btn-warning"
        (click)="onDeactivateStore()">
        <i class="fas fa-pause"></i>
        Deactivate Store
      </button>
    </div>
  </div>
</div>
