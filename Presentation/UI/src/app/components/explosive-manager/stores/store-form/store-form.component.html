<div *ngIf="isVisible" class="modal-overlay" (click)="onClose()">
  <div class="modal-content" (click)="onModalClick($event)">
    <div class="modal-header">
      <h3>
        <i class="fas fa-plus-circle" *ngIf="!isEditMode"></i>
        <i class="fas fa-edit" *ngIf="isEditMode"></i>
        {{ isEditMode ? 'Edit Store' : 'Add New Store' }}
      </h3>
      <button class="btn-close" (click)="onClose()" title="Close modal">
        <i class="fas fa-times"></i>
      </button>
    </div>
    
    <div class="modal-body">
      <!-- Success/Error Messages -->
      <div *ngIf="successMessage" class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        {{ successMessage }}
      </div>
      <div *ngIf="errorMessage" class="alert alert-danger">
        <i class="fas fa-exclamation-triangle"></i>
        {{ errorMessage }}
      </div>
      
      <form [formGroup]="storeForm" (ngSubmit)="onSubmit()">
        <!-- Basic Information -->
        <div class="form-section">
          <h4><i class="fas fa-info-circle"></i> Basic Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label><i class="fas fa-store"></i> Store Name *</label>
              <input 
                type="text" 
                class="form-control"
                formControlName="storeName"
                [class.is-invalid]="isFieldInvalid('storeName')"
                placeholder="Enter store name">
              <div *ngIf="isFieldInvalid('storeName')" class="error-message">
                <i class="fas fa-exclamation-circle"></i> Store name is required (minimum 2 characters)
              </div>
            </div>
          </div>
          
          <div class="form-group">
            <label><i class="fas fa-map-marker-alt"></i> Store Address *</label>
            <textarea 
              class="form-control"
              formControlName="storeAddress"
              [class.is-invalid]="isFieldInvalid('storeAddress')"
              placeholder="Enter complete store address"
              rows="3"></textarea>
            <div *ngIf="isFieldInvalid('storeAddress')" class="error-message">
              <i class="fas fa-exclamation-circle"></i> Store address is required
            </div>
          </div>
        </div>
        

        
        <!-- Location Information -->
        <div class="form-section">
          <h4><i class="fas fa-map-marked-alt"></i> Location Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label><i class="fas fa-city"></i> City *</label>
              <input
                type="text"
                class="form-control"
                formControlName="city"
                [class.is-invalid]="isFieldInvalid('city')"
                placeholder="Enter city name">
              <div *ngIf="isFieldInvalid('city')" class="error-message">
                <i class="fas fa-exclamation-circle"></i> City is required
              </div>
            </div>

            <div class="form-group">
              <label><i class="fas fa-globe-americas"></i> Region *</label>
              <select
                title="Region"
                class="form-select"
                formControlName="regionId"
                [class.is-invalid]="isFieldInvalid('regionId')">
                <option value="" disabled selected>Select a region</option>
                <option *ngFor="let region of regions; let i = index" [value]="i + 1">
                  {{ region }}
                </option>
              </select>
              <div *ngIf="isFieldInvalid('regionId')" class="error-message">
                <i class="fas fa-exclamation-circle"></i> Region is required
              </div>
            </div>
          </div>
        </div>
        
        <!-- Storage Information -->
        <div class="form-section">
          <h4><i class="fas fa-warehouse"></i> Storage Information</h4>
          <div class="form-row">
            <div class="form-group">
              <label><i class="fas fa-weight-hanging"></i> Storage Capacity (tons) *</label>
              <input
                type="number"
                class="form-control"
                formControlName="storageCapacity"
                [class.is-invalid]="isFieldInvalid('storageCapacity')"
                placeholder="Enter storage capacity in tons"
                min="1">
              <div *ngIf="isFieldInvalid('storageCapacity')" class="error-message">
                <i class="fas fa-exclamation-circle"></i> Storage capacity is required (minimum 1 ton)
              </div>
            </div>
          </div>
        </div>

        <!-- Allowed Explosive Types -->
        <div class="form-section">
          <h4><i class="fas fa-bomb"></i> Allowed Explosive Types</h4>
          <div class="explosive-types-grid">
            <div *ngFor="let type of explosiveTypesList" class="form-check">
              <input
                type="checkbox"
                class="form-check-input"
                [checked]="isExplosiveTypeSelected(type)"
                (change)="onExplosiveTypeChange($event, type)"
                [id]="'explosive-' + type"
                title="Select explosive type: {{ type }}"
                placeholder="Select explosive type">
                type="checkbox"
                class="form-check-input"
                [checked]="isExplosiveTypeSelected(type)"
                (change)="onExplosiveTypeChange($event, type)"
                [id]="'explosive-' + type">
              <label class="form-check-label" [for]="'explosive-' + type">
                <i class="fas fa-fire"></i> {{ type }}
              </label>
            </div>
          </div>
        </div>


        <!-- Status (only for edit mode) -->
        <div class="form-section" *ngIf="isEditMode">
          <h4><i class="fas fa-toggle-on"></i> Store Status</h4>
          <div class="form-row">
            <div class="form-group">
              <label><i class="fas fa-info-circle"></i> Current Status *</label>
              <select
                title="Store Status"
                class="form-select"
                formControlName="status"
                [class.is-invalid]="isFieldInvalid('status')">
                <option value="" disabled>Select current status</option>
                <option [value]="1">ðŸŸ¢ Operational</option>
                <option [value]="2">ðŸŸ¡ Under Maintenance</option>
                <option [value]="3">ðŸ”´ Temporarily Closed</option>
                <option [value]="4">ðŸŸ  Inspection Required</option>
                <option [value]="5">âš« Decommissioned</option>
              </select>
              <div *ngIf="isFieldInvalid('status')" class="error-message">
                <i class="fas fa-exclamation-circle"></i> Status is required
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
    
    <div class="modal-footer">
      <button 
        type="button" 
        class="btn btn-secondary"
        (click)="onClose()">
        <i class="fas fa-times"></i> Cancel
      </button>
      <button 
        type="submit" 
        class="btn btn-primary"
        (click)="onSubmit()"
        [disabled]="storeForm.invalid || isSubmitting">
        <i class="fas {{ isSubmitting ? 'fa-spinner fa-spin' : (isEditMode ? 'fa-edit' : 'fa-plus') }}"></i>
        {{ isSubmitting ? 'Saving...' : (isEditMode ? 'Update Store' : 'Create Store') }}
      </button>
    </div>
  </div>
</div>