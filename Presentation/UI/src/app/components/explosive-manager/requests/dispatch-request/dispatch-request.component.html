<div class="dispatch-container" *ngIf="request">
  <div class="page-header">
    <button mat-icon-button (click)="goBack()" class="back-button">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <div class="header-text">
      <h1>Dispatch Request</h1>
      <p>Prepare dispatch for approved explosive request</p>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <div class="card-header">
        <mat-icon>info</mat-icon>
        <h3>Request Summary</h3>
      </div>
      <div class="summary-grid">
        <div class="item"><label>Request ID:</label><span>{{request.id}}</span></div>
        <div class="item"><label>Store Location:</label><span>{{request.storeLocation}}</span></div>
        <div class="item"><label>Explosive Type:</label><span>{{request.explosiveType}}</span></div>
        <div class="item"><label>Approved Quantity:</label><span>{{request.approvedQuantity || request.quantity}} {{request.unit}}</span></div>
        <div class="item"><label>Departure Date:</label><span>{{request.departureDate | date:'mediumDate'}}</span></div>
        <div class="item"><label>Expected Receipt Date:</label><span>{{request.expectedReceiptDate | date:'mediumDate'}}</span></div>
        <div class="item"><label>Requester:</label><span>{{request.requesterName}} ({{request.requesterRole}})</span></div>
        <div class="item"><label>Purpose:</label><span>{{request.purpose}}</span></div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <mat-icon>local_shipping</mat-icon>
        <h3>Dispatch Details</h3>
      </div>

      <form [formGroup]="dispatchForm" (ngSubmit)="submit()" class="dispatch-form">
        <div class="row">
          <div class="field">
            <label for="truckNumber">Truck Number *</label>
            <input id="truckNumber" type="text" formControlName="truckNumber" placeholder="Enter truck number" [class.error]="hasError('truckNumber')" />
            <div class="error" *ngIf="getError('truckNumber')">{{getError('truckNumber')}}</div>
          </div>

          <div class="field">
            <label for="dispatchDate">Dispatch Date *</label>
            <input id="dispatchDate" type="date" formControlName="dispatchDate" [class.error]="hasError('dispatchDate')" />
            <div class="error" *ngIf="getError('dispatchDate')">{{getError('dispatchDate')}}</div>
          </div>
        </div>

        <div class="row">
          <div class="field">
            <label for="driverName">Driver Name</label>
            <input id="driverName" type="text" formControlName="driverName" placeholder="Enter driver name" />
            <small class="hint">Recommended but not required</small>
          </div>

          <div class="field">
            <label for="routeInformation">Route Information</label>
            <input id="routeInformation" type="text" formControlName="routeInformation" placeholder="Enter route details" />
          </div>
        </div>

        <div class="row">
          <div class="field full">
            <label for="additionalNotes">Additional Notes</label>
            <textarea id="additionalNotes" rows="3" formControlName="additionalNotes" placeholder="Any additional instructions or notes"></textarea>
          </div>
        </div>

        <div class="actions">
          <button mat-raised-button type="button" (click)="goBack()" class="cancel">
            <mat-icon>close</mat-icon>
            Cancel
          </button>
          <button mat-raised-button color="primary" type="submit" [disabled]="dispatchForm.invalid || isSubmitting" class="submit">
            <mat-icon>local_shipping</mat-icon>
            Dispatch
          </button>
        </div>
      </form>
    </div>
  </div>
</div>