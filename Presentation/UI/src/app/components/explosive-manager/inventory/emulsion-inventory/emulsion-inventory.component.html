<div class="emulsion-inventory-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <p>Loading Emulsion inventory...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage" class="error-state">
    <p>{{ errorMessage }}</p>
    <button (click)="loadInventory()">Retry</button>
  </div>

  <!-- Content -->
  <div *ngIf="!isLoading && !errorMessage">
    <!-- Header Section -->
    <div class="inventory-header">
      <div class="header-info">
        <h3>Emulsion Inventory Management</h3>
        <p>Water-resistant emulsion explosive inventory tracking</p>
      </div>
      <div class="header-actions">
        <button class="btn btn-primary" (click)="navigateToAdd()">
          <i class="material-icons">add</i>
          Add Inventory
        </button>
      </div>
    </div>

    <!-- Summary Cards -->
    <div class="summary-cards">
      <div class="summary-card">
        <div class="card-icon">
          <i class="material-icons">inventory_2</i>
        </div>
        <div class="card-content">
          <h4>Total Stock</h4>
          <p class="value">{{ (totalStock / 1000) | number:'1.2-2' }} tons</p>
        </div>
      </div>
      <div class="summary-card">
        <div class="card-icon">
          <i class="material-icons">inventory</i>
        </div>
        <div class="card-content">
          <h4>Total Batches</h4>
          <p class="value">{{ inventory.length }}</p>
        </div>
      </div>
      <div class="summary-card">
        <div class="card-icon">
          <i class="material-icons">warning</i>
        </div>
        <div class="card-content">
          <h4>Low Stock Items</h4>
          <p class="value">{{ lowStockCount }}</p>
        </div>
      </div>
    </div>

    <!-- Inventory Table -->
    <div class="inventory-table-container">
      <div class="table-header">
        <h4>Emulsion Stock Details</h4>
        <div class="table-actions">
          <button class="btn btn-secondary">
            <i class="material-icons">file_download</i>
            Export
          </button>
          <button class="btn btn-secondary" (click)="loadInventory()">
            <i class="material-icons">refresh</i>
            Refresh
          </button>
        </div>
      </div>

      <table class="inventory-table">
        <thead>
          <tr>
            <th>Batch ID</th>
            <th>Location</th>
            <th>Quantity (kg)</th>
            <th>Available (kg)</th>
            <th>Manufacturing Date</th>
            <th>Expiry Date</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of inventory">
            <td>{{ item.batchId }}</td>
            <td>{{ item.storageLocation }}</td>
            <td>{{ item.quantity | number:'1.2-2' }}</td>
            <td>{{ item.availableQuantity | number:'1.2-2' }}</td>
            <td>{{ item.manufacturingDate | date:'yyyy-MM-dd' }}</td>
            <td>{{ item.expiryDate | date:'yyyy-MM-dd' }}</td>
            <td><span class="status-badge" [ngClass]="getStatusClass(item)">{{ getStatusText(item) }}</span></td>
            <td>
              <button class="action-btn" title="View Details" (click)="viewDetails(item)">
                <i class="material-icons">visibility</i>
              </button>
              <button class="action-btn" title="Edit" (click)="navigateToEdit(item.id)">
                <i class="material-icons">edit</i>
              </button>
            </td>
          </tr>
          <tr *ngIf="inventory.length === 0">
            <td colspan="8" style="text-align: center;">No Emulsion inventory found</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Details Modal -->
  <div class="modal-overlay" *ngIf="showDetailsModal" (click)="closeDetailsModal()">
    <div class="modal-content" (click)="$event.stopPropagation()" *ngIf="selectedItem">
      <div class="modal-header">
        <h3>Emulsion Batch Details</h3>
        <button class="close-btn" (click)="closeDetailsModal()">
          <i class="material-icons">close</i>
        </button>
      </div>

      <div class="modal-body">
        <!-- Core Information -->
        <div class="detail-section">
          <h4><i class="material-icons">info</i> Core Information</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Batch ID:</label>
              <span>{{ selectedItem.batchId }}</span>
            </div>
            <div class="detail-item">
              <label>Status:</label>
              <span class="status-badge" [ngClass]="getStatusClass(selectedItem)">{{ selectedItem.status }}</span>
            </div>
            <div class="detail-item">
              <label>Supplier:</label>
              <span>{{ selectedItem.supplier }}</span>
            </div>
            <div class="detail-item">
              <label>Manufacturer Batch:</label>
              <span>{{ selectedItem.manufacturerBatchNumber || 'N/A' }}</span>
            </div>
          </div>
        </div>

        <!-- Quantity Information -->
        <div class="detail-section">
          <h4><i class="material-icons">inventory_2</i> Quantity Information</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Total Quantity:</label>
              <span>{{ selectedItem.quantity | number:'1.2-2' }} {{ selectedItem.unit }}</span>
            </div>
            <div class="detail-item">
              <label>Allocated:</label>
              <span>{{ selectedItem.allocatedQuantity | number:'1.2-2' }} {{ selectedItem.unit }}</span>
            </div>
            <div class="detail-item">
              <label>Available:</label>
              <span>{{ selectedItem.availableQuantity | number:'1.2-2' }} {{ selectedItem.unit }}</span>
            </div>
          </div>
        </div>

        <!-- Date Information -->
        <div class="detail-section">
          <h4><i class="material-icons">event</i> Date Information</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Manufacturing Date:</label>
              <span>{{ selectedItem.manufacturingDate | date:'yyyy-MM-dd' }}</span>
            </div>
            <div class="detail-item">
              <label>Expiry Date:</label>
              <span>{{ selectedItem.expiryDate | date:'yyyy-MM-dd' }}</span>
            </div>
            <div class="detail-item">
              <label>Created At:</label>
              <span>{{ selectedItem.createdAt | date:'yyyy-MM-dd HH:mm' }}</span>
            </div>
            <div class="detail-item">
              <label>Last Updated:</label>
              <span>{{ selectedItem.updatedAt | date:'yyyy-MM-dd HH:mm' }}</span>
            </div>
          </div>
        </div>

        <!-- Storage Information -->
        <div class="detail-section">
          <h4><i class="material-icons">warehouse</i> Storage Information</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Storage Location:</label>
              <span>{{ selectedItem.storageLocation }}</span>
            </div>
            <div class="detail-item">
              <label>Warehouse Store:</label>
              <span>{{ selectedItem.centralWarehouseStoreName || 'Store #' + selectedItem.centralWarehouseStoreId }}</span>
            </div>
          </div>
        </div>

        <!-- Technical Specifications (Emulsion Properties) -->
        <div class="detail-section" *ngIf="selectedItem.emulsionProperties">
          <h4><i class="material-icons">science</i> Technical Specifications</h4>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Density (Unsensitized):</label>
              <span>{{ selectedItem.emulsionProperties.densityUnsensitized | number:'1.2-2' }} g/cm³</span>
            </div>
            <div class="detail-item">
              <label>Density (Sensitized):</label>
              <span>{{ selectedItem.emulsionProperties.densitySensitized | number:'1.2-2' }} g/cm³</span>
            </div>
            <div class="detail-item">
              <label>Viscosity:</label>
              <span>{{ selectedItem.emulsionProperties.viscosity | number:'1.0-0' }} cP</span>
            </div>
            <div class="detail-item">
              <label>Water Content:</label>
              <span>{{ selectedItem.emulsionProperties.waterContent | number:'1.2-2' }}%</span>
            </div>
            <div class="detail-item">
              <label>pH:</label>
              <span>{{ selectedItem.emulsionProperties.pH | number:'1.1-1' }}</span>
            </div>
            <div class="detail-item">
              <label>Detonation Velocity:</label>
              <span>{{ selectedItem.emulsionProperties.detonationVelocity ? (selectedItem.emulsionProperties.detonationVelocity | number:'1.0-0') + ' m/s' : 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Bubble Size:</label>
              <span>{{ selectedItem.emulsionProperties.bubbleSize ? (selectedItem.emulsionProperties.bubbleSize | number:'1.0-0') + ' μm' : 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Storage Temperature:</label>
              <span>{{ selectedItem.emulsionProperties.storageTemperature }}°C</span>
            </div>
            <div class="detail-item">
              <label>Application Temperature:</label>
              <span>{{ selectedItem.emulsionProperties.applicationTemperature ? selectedItem.emulsionProperties.applicationTemperature + '°C' : 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Grade:</label>
              <span>{{ selectedItem.emulsionProperties.grade }}</span>
            </div>
            <div class="detail-item">
              <label>Color:</label>
              <span>{{ selectedItem.emulsionProperties.color }}</span>
            </div>
            <div class="detail-item">
              <label>Sensitization Type:</label>
              <span>{{ selectedItem.emulsionProperties.sensitizationType }}</span>
            </div>
            <div class="detail-item">
              <label>Sensitizer Content:</label>
              <span>{{ selectedItem.emulsionProperties.sensitizerContent ? (selectedItem.emulsionProperties.sensitizerContent | number:'1.2-2') + '%' : 'N/A' }}</span>
            </div>
            <div class="detail-item">
              <label>Fume Class:</label>
              <span>{{ selectedItem.emulsionProperties.fumeClass }}</span>
            </div>
            <div class="detail-item">
              <label>Quality Status:</label>
              <span class="status-badge">{{ selectedItem.emulsionProperties.qualityStatus }}</span>
            </div>
            <div class="detail-item">
              <label>Water Resistance:</label>
              <span>{{ selectedItem.emulsionProperties.waterResistance }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedItem.emulsionProperties.phaseSeparation !== undefined">
              <label>Phase Separation:</label>
              <span>{{ selectedItem.emulsionProperties.phaseSeparation ? 'Yes' : 'No' }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedItem.emulsionProperties.crystallization !== undefined">
              <label>Crystallization:</label>
              <span>{{ selectedItem.emulsionProperties.crystallization ? 'Yes' : 'No' }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedItem.emulsionProperties.colorConsistency !== undefined">
              <label>Color Consistency:</label>
              <span>{{ selectedItem.emulsionProperties.colorConsistency ? 'Yes' : 'No' }}</span>
            </div>
            <div class="detail-item" *ngIf="selectedItem.emulsionProperties.qualityCheckDate">
              <label>Quality Check Date:</label>
              <span>{{ selectedItem.emulsionProperties.qualityCheckDate | date:'yyyy-MM-dd' }}</span>
            </div>
          </div>
          <div class="detail-item full-width" *ngIf="selectedItem.emulsionProperties.notes">
            <label>Notes:</label>
            <p class="notes-text">{{ selectedItem.emulsionProperties.notes }}</p>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeDetailsModal()">Close</button>
        <button class="btn btn-primary" (click)="navigateToEdit(selectedItem.id); closeDetailsModal()">
          <i class="material-icons">edit</i> Edit
        </button>
      </div>
    </div>
  </div>
</div>