<mat-card class="usage-log-card">
  <mat-card-header>
    <mat-icon mat-card-avatar>history</mat-icon>
    <mat-card-title>Machine Usage History</mat-card-title>
    <mat-card-subtitle>Last {{ displayDays() }} days</mat-card-subtitle>
  </mat-card-header>

  <mat-card-content>
    @if (isLoading()) {
      <div class="loading-container">
        <mat-spinner diameter="30"></mat-spinner>
        <p>Loading usage logs...</p>
      </div>
    } @else if (usageLogs().length === 0) {
      <div class="no-data">
        <mat-icon>info</mat-icon>
        <p>No usage logs found for this machine.</p>
      </div>
    } @else {
      <div class="table-container">
        <table mat-table [dataSource]="usageLogs()" matSort class="usage-table">
          <!-- Date Column -->
          <ng-container matColumnDef="date">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Date</th>
            <td mat-cell *matCellDef="let log">{{ formatDate(log.logDate) }}</td>
          </ng-container>

          <!-- Engine Hours Column -->
          <ng-container matColumnDef="engineHours">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Engine Hours</th>
            <td mat-cell *matCellDef="let log">{{ calculateEngineHours(log).toFixed(1) }} h</td>
          </ng-container>

          <!-- Working Hours Column -->
          <ng-container matColumnDef="workingHours">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Working Hours</th>
            <td mat-cell *matCellDef="let log">{{ log.workingHours }} h</td>
          </ng-container>

          <!-- Idle Hours Column -->
          <ng-container matColumnDef="idleHours">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Idle Hours</th>
            <td mat-cell *matCellDef="let log">{{ log.idleHours }} h</td>
          </ng-container>

          <!-- Fuel Column -->
          <ng-container matColumnDef="fuel">
            <th mat-header-cell *matHeaderCellDef mat-sort-header>Fuel (L)</th>
            <td mat-cell *matCellDef="let log">{{ log.fuelConsumed ? (log.fuelConsumed + ' L') : '—' }}</td>
          </ng-container>

          <!-- Downtime Column -->
          <ng-container matColumnDef="downtime">
            <th mat-header-cell *matHeaderCellDef>Downtime</th>
            <td mat-cell *matCellDef="let log">
              @if (log.hasDowntime && log.downtimeHours) {
                <mat-icon
                  class="downtime-icon"
                  [matTooltip]="log.breakdownDescription || 'Downtime reported'"
                  matTooltipPosition="above">
                  warning
                </mat-icon>
              } @else {
                <span class="no-downtime">—</span>
              }
            </td>
          </ng-container>

          <!-- Status Column -->
          <ng-container matColumnDef="status">
            <th mat-header-cell *matHeaderCellDef>Status</th>
            <td mat-cell *matCellDef="let log">
              <mat-chip [ngClass]="getStatusClass(log.status)">
                {{ getStatusLabel(log.status) }}
              </mat-chip>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
        </table>
      </div>
    }
  </mat-card-content>
</mat-card>
