<!-- Dashboard Header: title, current user info, and global actions -->
<header class="dashboard-header">
  <div class="header-content">
    <h1>Mechanical Engineering Dashboard</h1>
    <div class="user-info">
      <div class="user-details" *ngIf="currentUser">
        <span class="welcome-message">{{ getUserWelcomeMessage() }}</span>
        <div class="user-metadata">
          <span class="user-role">Role: {{ currentUser.role }}</span>
          <span class="user-location" *ngIf="getUserLocationInfo()">{{ getUserLocationInfo() }}</span>
          <span class="last-login">{{ getLastLoginInfo() }}</span>
        </div>
      </div>
      <button class="refresh-btn" (click)="refreshDashboard()" title="Refresh dashboard data">
        <i class="material-icons">refresh</i>
        Refresh
      </button>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>
  </div>
</header>

<div class="loading-container" *ngIf="isLoading">
  <div class="spinner"></div>
  <p>Loading mechanical engineering dashboard...</p>
</div>

<div class="dashboard-content" *ngIf="!isLoading">
  <!-- Critical Maintenance Alerts -->
  <div class="alerts-section" *ngIf="criticalAlerts.length > 0">
    <h3>
      <i class="material-icons alert-icon">warning</i>
      Critical Equipment Alerts
    </h3>
    <div class="alert-list">
      <div class="alert-card" *ngFor="let alert of criticalAlerts()" [class]="'alert-' + alert.priority.toLowerCase()">
        <div class="alert-icon">
          <i class="material-icons">{{ alert.icon }}</i>
        </div>
        <div class="alert-content">
          <h4>{{ alert.machineName }}</h4>
          <p>{{ alert.message }}</p>
          <span class="alert-time">{{ alert.timestamp }}</span>
        </div>
        <div class="alert-priority" [class]="'priority-' + alert.priority.toLowerCase()">
          {{ alert.priority }}
        </div>
      </div>
    </div>
  </div>

  <!-- KPI Cards -->
  <div class="stats-grid">
    <div class="stat-card machines">
      <div class="stat-icon"><i class="material-icons">precision_manufacturing</i></div>
      <div class="stat-content">
        <h3>Total Equipment</h3>
        <p class="stat-number">{{ mechanicalStats().totalEquipment }}</p>
      </div>
    </div>
    <div class="stat-card operational">
      <div class="stat-icon"><i class="material-icons">check_circle</i></div>
      <div class="stat-content">
        <h3>Operational</h3>
        <p class="stat-number">{{ mechanicalStats().operationalEquipment }}</p>
      </div>
    </div>
    <div class="stat-card maintenance">
      <div class="stat-icon"><i class="material-icons">build_circle</i></div>
      <div class="stat-content">
        <h3>Under Maintenance</h3>
        <p class="stat-number">{{ mechanicalStats().underMaintenance }}</p>
      </div>
    </div>
    <div class="stat-card efficiency">
      <div class="stat-icon"><i class="material-icons">trending_up</i></div>
      <div class="stat-content">
        <h3>Efficiency Rate</h3>
        <p class="stat-number">{{ mechanicalStats().efficiencyRate }}%</p>
      </div>
    </div>
  </div>

  <!-- Equipment Performance Overview -->
  <div class="performance-panel">
    <h3>
      <i class="material-icons">analytics</i>
      Equipment Performance Overview
    </h3>
    <div class="performance-grid">
      <div class="performance-card" *ngFor="let equipment of equipmentPerformance()">
        <div class="performance-header">
          <h4>{{ equipment.machineName }}</h4>
          <span class="efficiency-badge" [class]="getEfficiencyClass(equipment.efficiency)">
            {{ equipment.efficiency }}%
          </span>
        </div>
        <div class="performance-metrics">
          <div class="metric">
            <span class="metric-label">Uptime</span>
            <span class="metric-value">{{ equipment.uptime }}%</span>
          </div>
          <div class="metric">
            <span class="metric-label">Last Service</span>
            <span class="metric-value">{{ equipment.lastService }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Maintenance Schedule -->
  <div class="maintenance-schedule-panel">
    <h3>
      <i class="material-icons">event_note</i>
      Upcoming Maintenance Schedule
    </h3>
    <div *ngIf="machinesNeedingMaintenance().length > 0; else noUpcoming">
      <div class="maintenance-list">
        <div class="maintenance-item" *ngFor="let machine of machinesNeedingMaintenance()">
          <div class="machine-info">
            <h4>{{ machine.name }}</h4>
            <p>{{ machine.type }}</p>
          </div>
          <div class="maintenance-details">
            <span class="maintenance-type">{{ machine.nextMaintenanceType }}</span>
            <span class="maintenance-date">{{ machine.nextMaintenanceDate }}</span>
          </div>
          <div class="maintenance-priority" [class]="'priority-' + machine.priority">
            {{ machine.priority }}
          </div>
        </div>
      </div>
    </div>
    <ng-template #noUpcoming>
      <p>No equipment scheduled for maintenance.</p>
    </ng-template>
  </div>

  <!-- Spare Parts Inventory -->
  <div class="inventory-panel">
    <h3>
      <i class="material-icons">inventory_2</i>
      Spare Parts Inventory
    </h3>
    <div *ngIf="lowStockParts().length > 0; else noLowStock">
      <div class="parts-grid">
        <div class="part-card" *ngFor="let part of lowStockParts()" [class]="getStockLevelClass(part)">
          <div class="part-info">
            <h4>{{ part.name }}</h4>
            <span class="part-code">{{ part.partNumber }}</span>
          </div>
          <div class="stock-info">
            <div class="stock-level">
              <span class="current-stock">{{ part.currentStock }}</span>
              <span class="stock-separator">/</span>
              <span class="min-stock">{{ part.minStock }}</span>
            </div>
            <div class="stock-status" [class]="getStockStatusClass(part)">
              {{ getStockStatus(part) }}
            </div>
          </div>
        </div>
      </div>
    </div>
    <ng-template #noLowStock>
      <p>All spare parts are adequately stocked.</p>
    </ng-template>
  </div>

  <!-- Quick Actions Panel -->
  <div class="quick-actions-panel">
    <h3>
      <i class="material-icons">flash_on</i>
      Quick Actions
    </h3>
    <div class="action-cards">
      <div class="action-card maintenance-action" (click)="navigateToMaintenance()">
        <div class="action-icon"><i class="material-icons">build</i></div>
        <h4>Maintenance Management</h4>
        <p>Schedule and track maintenance activities</p>
        <div class="action-status">{{ mechanicalStats().pendingMaintenance }} pending</div>
      </div>
      <div class="action-card equipment-action" (click)="navigateToEquipment()">
        <div class="action-icon"><i class="material-icons">precision_manufacturing</i></div>
        <h4>Equipment Management</h4>
        <p>Monitor and manage equipment status</p>
        <div class="action-status">{{ mechanicalStats().totalEquipment }} units</div>
      </div>
      <div class="action-card analytics-action" (click)="navigateToAnalytics()">
        <div class="action-icon"><i class="material-icons">analytics</i></div>
        <h4>Performance Analytics</h4>
        <p>View equipment performance reports</p>
        <div class="action-status">View reports</div>
      </div>
    </div>
  </div>

  <!-- Recent Activities Panel -->
  <div class="activities-panel">
    <h3>
      <i class="material-icons">history</i>
      Recent Maintenance Activities
    </h3>
    <div class="activity-list">
      <div class="activity-item" *ngFor="let activity of recentActivities()">
        <div class="activity-icon">
          <i class="material-icons">{{ activity.icon }}</i>
        </div>
        <div class="activity-content">
          <h4>{{ activity.title }}</h4>
          <p>{{ activity.description }}</p>
          <span class="activity-time">{{ activity.timestamp }}</span>
        </div>
        <div class="activity-status" [class]="'status-' + activity.type">
          {{ activity.type }}
        </div>
      </div>
    </div>
  </div>
</div>
