<!-- Dashboard Header -->
<header class="dashboard-header">
  <div class="header-content">
    <h1>Mechanical Engineer Dashboard</h1>
    <div class="user-info">
      <div class="user-details" *ngIf="currentUser">
        <span class="welcome-message">{{ getUserWelcomeMessage() }}</span>
        <div class="user-metadata">
          <span class="user-role">Role: {{ currentUser.role }}</span>
          <span class="user-location" *ngIf="getUserLocationInfo()">{{ getUserLocationInfo() }}</span>
          <span class="last-login">{{ getLastLoginInfo() }}</span>
        </div>
      </div>
      <button class="refresh-btn" (click)="refreshDashboard()" title="Refresh dashboard data">
        <i class="material-icons">refresh</i>
        Refresh
      </button>
      <button class="logout-btn" (click)="logout()">Logout</button>
    </div>
  </div>
</header>

<div class="loading-container" *ngIf="isLoading()">
  <div class="spinner"></div>
  <p>Loading dashboard...</p>
</div>

<div class="dashboard-content" *ngIf="!isLoading()">
  <!-- Quick Summary Cards -->
  <div class="stats-grid">
    <div class="stat-card scheduled">
      <div class="stat-icon"><i class="material-icons">event</i></div>
      <div class="stat-content">
        <h3>Total Scheduled</h3>
        <p class="stat-number">{{ mechanicalStats().underMaintenance }}</p>
      </div>
    </div>
    <div class="stat-card completed">
      <div class="stat-icon"><i class="material-icons">check_circle</i></div>
      <div class="stat-content">
        <h3>Completed</h3>
        <p class="stat-number">{{ stats().completedThisWeek }}</p>
      </div>
    </div>
    <div class="stat-card pending">
      <div class="stat-icon"><i class="material-icons">pending</i></div>
      <div class="stat-content">
        <h3>Pending</h3>
        <p class="stat-number">{{ stats().pendingTasks }}</p>
      </div>
    </div>
    <div class="stat-card alerts">
      <div class="stat-icon"><i class="material-icons">warning</i></div>
      <div class="stat-content">
        <h3>Active Alerts</h3>
        <p class="stat-number">{{ maintenanceAlerts().length }}</p>
      </div>
    </div>
  </div>

  <!-- Machines Scheduled for Maintenance -->
  <div class="maintenance-schedule-panel">
    <h3>
      <i class="material-icons">build_circle</i>
      Machines Scheduled for Maintenance
    </h3>
    <div *ngIf="machinesNeedingMaintenance().length > 0; else noScheduled">
      <div class="maintenance-table">
        <table>
          <thead>
            <tr>
              <th>Machine Name</th>
              <th>Type</th>
              <th>Project</th>
              <th>Scheduled Date</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let machine of machinesNeedingMaintenance()">
              <td>{{ machine.name }}</td>
              <td>{{ machine.type }}</td>
              <td>{{ machine.assignedProject || 'N/A' }}</td>
              <td>{{ machine.nextMaintenanceDate }}</td>
              <td>
                <span class="status-badge" [class]="machine.status.toLowerCase()">
                  {{ machine.status | titlecase }}
                </span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <ng-template #noScheduled>
      <p class="empty-message">No machines scheduled for maintenance.</p>
    </ng-template>
  </div>

  <!-- Service Alerts -->
  <div class="alerts-section">
    <h3>
      <i class="material-icons">notifications_active</i>
      Service Alerts
    </h3>
    <div *ngIf="maintenanceAlerts().length > 0; else noAlerts">
      <div class="alert-list">
        <div class="alert-card" *ngFor="let alert of maintenanceAlerts()" [class]="'alert-' + alert.priority.toLowerCase()">
          <div class="alert-icon">
            <i class="material-icons">{{ alert.icon }}</i>
          </div>
          <div class="alert-content">
            <h4>{{ alert.machineName }}</h4>
            <p>{{ alert.message }}</p>
            <span class="alert-time">{{ alert.timestamp }}</span>
          </div>
          <div class="alert-priority" [class]="'priority-' + alert.priority.toLowerCase()">
            {{ alert.priority }}
          </div>
        </div>
      </div>
    </div>
    <ng-template #noAlerts>
      <p class="empty-message">No service alerts at this time.</p>
    </ng-template>
  </div>

  <!-- Accessory/Spare-Part Alerts -->
  <div class="inventory-panel">
    <h3>
      <i class="material-icons">inventory_2</i>
      Accessory / Spare-Part Alerts
    </h3>
    <div *ngIf="lowStockParts().length > 0; else noLowStock">
      <div class="parts-grid">
        <div class="part-card" *ngFor="let part of lowStockParts()" [class]="getStockLevelClass(part)">
          <div class="part-info">
            <h4>{{ part.name }}</h4>
            <span class="part-code">{{ part.partNumber }}</span>
          </div>
          <div class="stock-info">
            <div class="stock-level">
              <span class="current-stock">{{ part.currentStock }}</span>
              <span class="stock-separator">/</span>
              <span class="min-stock">{{ part.minimumStock }}</span>
            </div>
            <div class="stock-status" [class]="getStockStatusClass(part)">
              {{ getStockStatus(part) }}
            </div>
          </div>
        </div>
      </div>
    </div>
    <ng-template #noLowStock>
      <p class="empty-message">All accessories are adequately stocked.</p>
    </ng-template>
  </div>

  <!-- Recent Maintenance Logs -->
  <div class="activities-panel">
    <h3>
      <i class="material-icons">history</i>
      Recent Maintenance Logs
    </h3>
    <div *ngIf="recentActivities().length > 0; else noActivities">
      <div class="activity-list">
        <div class="activity-item" *ngFor="let activity of recentActivities()">
          <div class="activity-icon">
            <i class="material-icons">{{ activity.icon }}</i>
          </div>
          <div class="activity-content">
            <h4>{{ activity.title }}</h4>
            <p>{{ activity.description }}</p>
            <span class="activity-time">{{ activity.timestamp }}</span>
          </div>
          <div class="activity-status" [class]="'status-' + activity.type">
            {{ activity.type }}
          </div>
        </div>
      </div>
    </div>
    <ng-template #noActivities>
      <p class="empty-message">No recent maintenance activities.</p>
    </ng-template>
  </div>
</div>
