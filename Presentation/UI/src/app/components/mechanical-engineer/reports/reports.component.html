<div class="reports-container">
  <!-- Dashboard Header -->
  <div class="dashboard-header">
    <div class="header-content">
      <div class="header-title">
        <h1>Maintenance Reports</h1>
        <p>Track maintenance jobs, machine performance, and parts usage</p>
      </div>

      <div class="header-actions">
        <button
          type="button"
          class="action-btn export-btn"
          (click)="exportAllReports()"
          [disabled]="isLoading()"
          title="Export report"
        >
          <i class="material-icons">file_download</i>
          Export
        </button>
        <button
          type="button"
          class="action-btn print-btn"
          (click)="printAllReports()"
          [disabled]="isLoading()"
          title="Print report"
        >
          <i class="material-icons">print</i>
          Print
        </button>
        <button
          type="button"
          class="refresh-btn"
          (click)="refreshReports()"
          [disabled]="isLoading()"
          title="Refresh reports"
        >
          <i class="material-icons" [class.spinning]="isLoading()">refresh</i>
          Refresh
        </button>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Loading reports...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="error-message">
      <i class="material-icons">error_outline</i>
      <p>{{ error() }}</p>
    </div>
  }

  <!-- Reports Content -->
  @if (!isLoading()) {
    <div class="reports-content">
      <!-- Quick Stats Overview -->
      <div class="quick-stats">
        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
            <i class="material-icons">assignment</i>
          </div>
          <div class="stat-info">
            <div class="stat-value">{{ maintenanceSummary().totalJobs }}</div>
            <div class="stat-label">Total Jobs</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
            <i class="material-icons">check_circle</i>
          </div>
          <div class="stat-info">
            <div class="stat-value">{{ maintenanceSummary().byStatus.completed }}</div>
            <div class="stat-label">Completed</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
            <i class="material-icons">schedule</i>
          </div>
          <div class="stat-info">
            <div class="stat-value">{{ maintenanceSummary().byStatus.inProgress }}</div>
            <div class="stat-label">In Progress</div>
          </div>
        </div>

        <div class="stat-card">
          <div class="stat-icon" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
            <i class="material-icons">warning</i>
          </div>
          <div class="stat-info">
            <div class="stat-value">{{ maintenanceSummary().byStatus.overdue }}</div>
            <div class="stat-label">Overdue</div>
          </div>
        </div>
      </div>

      <!-- Tabs Navigation -->
      <div class="tabs-container">
        <div class="tabs-nav">
          <button
            class="tab-btn"
            [class.active]="activeTab() === 'summary'"
            (click)="switchTab('summary')"
          >
            <i class="material-icons">assessment</i>
            Maintenance Summary
          </button>
          <button
            class="tab-btn"
            [class.active]="activeTab() === 'performance'"
            (click)="switchTab('performance')"
          >
            <i class="material-icons">speed</i>
            Machine Performance
          </button>
          <button
            class="tab-btn"
            [class.active]="activeTab() === 'parts'"
            (click)="switchTab('parts')"
          >
            <i class="material-icons">build</i>
            Parts Usage
          </button>
        </div>

        <div class="tabs-content">
          <!-- Maintenance Summary Tab -->
          @if (activeTab() === 'summary') {
            <div class="tab-panel">
              <div class="summary-metrics">
                <div class="metrics-row">
                  <div class="metric-group">
                    <h3>Jobs by Type</h3>
                    <div class="metric-items">
                      <div class="metric-item">
                        <span class="metric-dot" [style.background]="getTypeColor(MaintenanceType.PREVENTIVE)"></span>
                        <span class="metric-label">Preventive:</span>
                        <span class="metric-value">{{ maintenanceSummary().byType.preventive }}</span>
                      </div>
                      <div class="metric-item">
                        <span class="metric-dot" [style.background]="getTypeColor(MaintenanceType.CORRECTIVE)"></span>
                        <span class="metric-label">Corrective:</span>
                        <span class="metric-value">{{ maintenanceSummary().byType.corrective }}</span>
                      </div>
                      <div class="metric-item">
                        <span class="metric-dot" [style.background]="getTypeColor(MaintenanceType.PREDICTIVE)"></span>
                        <span class="metric-label">Predictive:</span>
                        <span class="metric-value">{{ maintenanceSummary().byType.predictive }}</span>
                      </div>
                      <div class="metric-item">
                        <span class="metric-dot" [style.background]="getTypeColor(MaintenanceType.EMERGENCY)"></span>
                        <span class="metric-label">Emergency:</span>
                        <span class="metric-value">{{ maintenanceSummary().byType.emergency }}</span>
                      </div>
                    </div>
                  </div>

                  <div class="metric-group">
                    <h3>Performance Metrics</h3>
                    <div class="metric-items">
                      <div class="metric-item">
                        <i class="material-icons" style="color: #667eea;">timer</i>
                        <span class="metric-label">Avg Completion:</span>
                        <span class="metric-value">{{ maintenanceSummary().avgCompletionTime }}h</span>
                      </div>
                      <div class="metric-item">
                        <i class="material-icons" style="color: #10b981;">event_available</i>
                        <span class="metric-label">On-Time Rate:</span>
                        <span class="metric-value">{{ maintenanceSummary().onTimeCompletion }}%</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="table-section">
                <h3>All Maintenance Jobs</h3>
                <div class="table-responsive">
                  <table class="data-table">
                    <thead>
                      <tr>
                        <th>Machine</th>
                        <th>Type</th>
                        <th>Status</th>
                        <th>Scheduled</th>
                        <th>Hours</th>
                        <th>Reason</th>
                      </tr>
                    </thead>
                    <tbody>
                      @if (maintenanceJobs().length === 0) {
                        <tr>
                          <td colspan="6" class="no-data">No maintenance jobs found</td>
                        </tr>
                      }
                      @for (job of maintenanceJobs(); track job.id) {
                        <tr>
                          <td class="font-semibold">{{ job.machineName }}</td>
                          <td>
                            <span class="type-badge" [style.background]="getTypeColor(job.type)">
                              {{ job.type }}
                            </span>
                          </td>
                          <td>
                            <span class="status-badge" [style.background]="getStatusColor(job.status)">
                              {{ job.status.replace('_', ' ') }}
                            </span>
                          </td>
                          <td>{{ formatDate(job.scheduledDate) }}</td>
                          <td>{{ job.actualHours || job.estimatedHours }}h</td>
                          <td class="reason-cell">{{ job.reason }}</td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          }

          <!-- Machine Performance Tab -->
          @if (activeTab() === 'performance') {
            <div class="tab-panel">
              <div class="performance-info">
                <div class="info-card">
                  <i class="material-icons">info</i>
                  <div>
                    <strong>MTBF:</strong> Mean Time Between Failures - Average operating time between breakdowns
                  </div>
                </div>
                <div class="info-card">
                  <i class="material-icons">info</i>
                  <div>
                    <strong>MTTR:</strong> Mean Time To Repair - Average time required to complete repairs
                  </div>
                </div>
              </div>

              <div class="table-section">
                <div class="table-responsive">
                  <table class="data-table">
                    <thead>
                      <tr>
                        <th>Machine</th>
                        <th>Uptime (hrs)</th>
                        <th>Downtime (hrs)</th>
                        <th>MTBF (hrs)</th>
                        <th>MTTR (hrs)</th>
                        <th>Efficiency</th>
                      </tr>
                    </thead>
                    <tbody>
                      @if (machinePerformanceData().length === 0) {
                        <tr>
                          <td colspan="6" class="no-data">No performance data available</td>
                        </tr>
                      }
                      @for (machine of machinePerformanceData(); track machine.machineId) {
                        <tr>
                          <td class="font-semibold">{{ machine.machineName }}</td>
                          <td>{{ machine.uptime.toFixed(1) }}</td>
                          <td>{{ machine.downtime.toFixed(1) }}</td>
                          <td>{{ machine.mtbf.toFixed(1) }}</td>
                          <td>{{ machine.mttr.toFixed(1) }}</td>
                          <td>
                            <span class="efficiency-badge"
                              [class.high]="machine.efficiency >= 90"
                              [class.medium]="machine.efficiency >= 70 && machine.efficiency < 90"
                              [class.low]="machine.efficiency < 70">
                              {{ machine.efficiency }}%
                            </span>
                          </td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          }

          <!-- Parts Usage Tab -->
          @if (activeTab() === 'parts') {
            <div class="tab-panel">
              <div class="parts-summary">
                <div class="summary-card-inline">
                  <i class="material-icons">inventory_2</i>
                  <div>
                    <div class="summary-value">{{ partsUsageData().length }}</div>
                    <div class="summary-label">Different Parts Used</div>
                  </div>
                </div>
              </div>

              <div class="table-section">
                <div class="table-responsive">
                  <table class="data-table">
                    <thead>
                      <tr>
                        <th>Part Name</th>
                        <th>Quantity Used</th>
                        <th>Machines</th>
                      </tr>
                    </thead>
                    <tbody>
                      @if (partsUsageData().length === 0) {
                        <tr>
                          <td colspan="3" class="no-data">No parts usage data available</td>
                        </tr>
                      }
                      @for (part of partsUsageData(); track part.partName) {
                        <tr>
                          <td class="font-semibold">{{ part.partName }}</td>
                          <td>{{ part.quantity }}</td>
                          <td class="machines-cell">{{ part.machines.join(', ') }}</td>
                        </tr>
                      }
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>
