<div class="site-details-container">
  <!-- Header -->
  <div class="site-header">
    <button class="back-button" (click)="goBack()">
      <i class="fas fa-arrow-left"></i> Back to Project
    </button>
    <div class="site-title" *ngIf="site">
      <h1>{{ site.name }}</h1>
      <div class="site-meta">
        <span class="location">
          <i class="fas fa-map-marker-alt"></i> {{ site.location }}
        </span>
        <span class="status" [class]="'status-' + site.status?.toLowerCase()">
          <i class="fas" [class.fa-check-circle]="site.isPatternApproved" 
             [class.fa-clock]="!site.isPatternApproved"></i>
          {{ site.isPatternApproved ? 'Pattern Approved' : 'Pending Approval' }}
        </span>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading site details...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="error-container">
    <i class="fas fa-exclamation-triangle"></i>
    <p>{{ error }}</p>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading && !error && site" class="site-content">
    <!-- Navigation Tabs -->
    <div class="tab-navigation">
      <button class="tab-button"
              [class.active]="activeTab === 'overview'"
              (click)="setActiveTab('overview')">
        <i class="fas fa-info-circle"></i> Overview
      </button>
      <button class="tab-button"
              [class.active]="activeTab === 'drill-points'"
              (click)="setActiveTab('drill-points')">
        <i class="fas fa-map-marker-alt"></i> Drill Points
      </button>
    </div>

    <!-- Tab Content -->
    <div class="tab-content">
      <!-- Overview Tab -->
      <div *ngIf="activeTab === 'overview'" class="tab-panel">
        <div class="overview-grid">
          <div class="info-card">
            <h3>Site Information</h3>
            <div class="info-row">
              <span class="label">Name:</span>
              <span class="value">{{ site.name }}</span>
            </div>
            <div class="info-row">
              <span class="label">Description:</span>
              <span class="value">{{ site.description || 'No description available' }}</span>
            </div>
            <div class="info-row">
              <span class="label">Location:</span>
              <span class="value">{{ site.location }}</span>
            </div>
            <div class="info-row">
              <span class="label">Last Updated:</span>
              <span class="value">{{ site.lastUpdated | date:'medium' }}</span>
            </div>
          </div>

          <div class="info-card">
            <h3>Pattern Status</h3>
            <div class="pattern-status">
              <div class="status-indicator" [class.approved]="site.isPatternApproved">
                <i class="fas" [class.fa-check-circle]="site.isPatternApproved" 
                   [class.fa-clock]="!site.isPatternApproved"></i>
                {{ site.isPatternApproved ? 'Approved' : 'Pending' }}
              </div>
              <p class="status-description">
                {{ site.isPatternApproved ? 
                   'Blast pattern has been approved and is ready for execution.' : 
                   'Blast pattern is pending approval from the Blasting Engineer.' }}
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Drill Points Tab -->
      <div *ngIf="activeTab === 'drill-points'" class="tab-panel">
        <div class="calculations-header">
          <h3>Drill Points</h3>
          <p>View all drill points defined for this site.</p>
        </div>

        <!-- Loading State for Drill Points -->
        <div *ngIf="loadingDrillPoints" class="loading-container">
          <div class="loading-spinner"></div>
          <p>Loading drill points...</p>
        </div>

        <div *ngIf="!loadingDrillPoints" class="calculations-table">
          <p-table
            [value]="drillPoints"
            [paginator]="true"
            [rows]="10"
            [showCurrentPageReport]="true"
            currentPageReportTemplate="Showing {first} to {last} of {totalRecords} drill points"
            [rowsPerPageOptions]="[10, 25, 50]"
            [tableStyle]="{ 'min-width': '40rem' }"
            styleClass="p-datatable-striped"
            [rowHover]="true">

            <ng-template pTemplate="header">
              <tr>
                <th pSortableColumn="id">
                  Point ID <p-sortIcon field="id" />
                </th>
                <th pSortableColumn="depth">
                  Depth (m) <p-sortIcon field="depth" />
                </th>
                <th pSortableColumn="spacing">
                  Spacing (m) <p-sortIcon field="spacing" />
                </th>
                <th pSortableColumn="burden">
                  Burden (m) <p-sortIcon field="burden" />
                </th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </ng-template>

            <ng-template pTemplate="body" let-point>
              <tr>
                <td><strong>{{ point.id }}</strong></td>
                <td>{{ point.depth | number:'1.2-2' }}</td>
                <td>{{ point.spacing | number:'1.2-2' }}</td>
                <td>{{ point.burden | number:'1.2-2' }}</td>
                <td>
                  <p-tag
                    [value]="getStatus(point.id)"
                    [severity]="getStatus(point.id) === 'completed' ? 'success' : 'warning'"
                    [style]="{'text-transform': 'capitalize'}">
                  </p-tag>
                </td>
                <td>
                  <button
                    pButton
                    type="button"
                    label="Completed"
                    icon="pi pi-check"
                    [disabled]="isCompleted(point.id)"
                    (click)="markAsCompleted(point.id)"
                    class="p-button-sm"
                    [class.p-button-success]="!isCompleted(point.id)"
                    [class.p-button-secondary]="isCompleted(point.id)">
                  </button>
                </td>
              </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
              <tr>
                <td colspan="6" class="text-center">
                  <div class="p-4">
                    <i class="pi pi-info-circle text-4xl text-gray-400"></i>
                    <p class="mt-2 text-gray-500">No drill points found for this site.</p>
                  </div>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </div>
      </div>
    </div>
  </div>
</div>