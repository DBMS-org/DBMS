<!-- Compact Dashboard Header -->
<header class="dashboard-header-compact">
  <div class="header-content">
    <div class="header-left">
      <h1>General Manager Dashboard</h1>
      <span class="header-subtitle">System Overview & Management</span>
    </div>
    <div class="header-right">
      <span class="welcome-text" *ngIf="currentUser">{{ getUserWelcomeMessage() }}</span>
      <button type="button" class="refresh-btn-compact" (click)="refreshDashboard()" title="Refresh dashboard data">
        <i class="material-icons">refresh</i>
      </button>
    </div>
  </div>
</header>

<!-- Loading State -->
<div class="loading-container" *ngIf="isLoading">
  <div class="spinner"></div>
  <p>Loading dashboard data...</p>
</div>

<!-- Compact Dashboard Grid -->
<div class="dashboard-grid" *ngIf="!isLoading">

  <!-- Top Row: Key Metrics + Widgets (2/3 + 1/3 split) -->
  <div class="grid-row-top">
    <!-- Left: Stats Overview -->
    <div class="stats-overview">
      <!-- User Stats -->
      <div class="stat-group">
        <h3 class="stat-group-title"><i class="material-icons">people</i> Users</h3>
        <div class="stat-cards-compact">
          <div class="stat-card-mini users">
            <span class="stat-label">Total</span>
            <span class="stat-value">{{ stats.totalUsers }}</span>
          </div>
          <div class="stat-card-mini active">
            <span class="stat-label">Active</span>
            <span class="stat-value">{{ stats.activeUsers }}</span>
          </div>
          <div class="stat-card-mini deactivated">
            <span class="stat-label">Inactive</span>
            <span class="stat-value">{{ stats.deactivatedUsers }}</span>
          </div>
        </div>
      </div>

      <!-- Project Stats -->
      <div class="stat-group">
        <h3 class="stat-group-title"><i class="material-icons">work</i> Projects</h3>
        <div class="stat-cards-compact">
          <div class="stat-card-mini projects">
            <span class="stat-label">Total</span>
            <span class="stat-value">{{ stats.totalProjects }}</span>
          </div>
          <div class="stat-card-mini pending-projects">
            <span class="stat-label">Pending</span>
            <span class="stat-value">{{ stats.pendingProjects }}</span>
          </div>
          <div class="stat-card-mini active-projects">
            <span class="stat-label">Active</span>
            <span class="stat-value">{{ stats.activeProjects }}</span>
          </div>
          <div class="stat-card-mini completed-projects">
            <span class="stat-label">Done</span>
            <span class="stat-value">{{ stats.completedProjects }}</span>
          </div>
        </div>
      </div>

      <!-- Machine Stats -->
      <div class="stat-group">
        <h3 class="stat-group-title"><i class="material-icons">precision_manufacturing</i> Machines</h3>
        <div class="stat-cards-compact">
          <div class="stat-card-mini machines">
            <span class="stat-label">Total</span>
            <span class="stat-value">{{ stats.totalMachines }}</span>
          </div>
          <div class="stat-card-mini assigned-machines">
            <span class="stat-label">Assigned</span>
            <span class="stat-value">{{ stats.assignedMachines }}</span>
          </div>
          <div class="stat-card-mini pending-assignments">
            <span class="stat-label">Pending</span>
            <span class="stat-value">{{ stats.pendingAssignments }}</span>
          </div>
          <div class="stat-card-mini machine-requests">
            <span class="stat-label">Requests</span>
            <span class="stat-value">{{ stats.machineRequests }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Right: Critical Widgets -->
    <div class="widgets-compact">
      <!-- Pending Approvals -->
      <div class="widget-compact approvals">
        <div class="widget-header-compact">
          <i class="material-icons">pending_actions</i>
          <h4>Pending Approvals</h4>
        </div>
        <div class="approval-list-compact">
          <div class="approval-item-compact" (click)="navigateToMachineAssignments()">
            <span class="approval-label-compact">Machine Requests</span>
            <span class="approval-count-compact">{{ stats.machineRequests }}</span>
          </div>
          <div class="approval-item-compact" (click)="navigateToProjects()">
            <span class="approval-label-compact">Pending Projects</span>
            <span class="approval-count-compact">{{ stats.pendingProjects }}</span>
          </div>
          <div class="approval-item-compact" (click)="navigateToMachineAssignments()">
            <span class="approval-label-compact">Assignments</span>
            <span class="approval-count-compact">{{ stats.pendingAssignments }}</span>
          </div>
        </div>
      </div>

      <!-- System Status -->
      <div class="widget-compact status">
        <div class="widget-header-compact">
          <i class="material-icons">settings</i>
          <h4>System Status</h4>
        </div>
        <div class="status-list-compact">
          <div class="status-item-compact">
            <div class="status-dot online"></div>
            <span>Database Online</span>
          </div>
          <div class="status-item-compact">
            <div class="status-dot online"></div>
            <span>API Running</span>
          </div>
          <div class="status-item-compact">
            <i class="material-icons">schedule</i>
            <span>{{ getLastSyncTime() }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Middle Row: Quick Actions (Horizontal) -->
  <div class="grid-row-actions">
    <div class="section-header-compact">
      <i class="material-icons">flash_on</i>
      <h3>Quick Actions</h3>
    </div>
    <div class="action-cards-horizontal">
      <div class="action-card-compact" (click)="navigateToUsers()">
        <i class="material-icons">manage_accounts</i>
        <span>User Management</span>
      </div>
      <div class="action-card-compact" (click)="navigateToProjects()">
        <i class="material-icons">work</i>
        <span>Projects</span>
      </div>
      <div class="action-card-compact" (click)="navigateToMachineInventory()">
        <i class="material-icons">inventory</i>
        <span>Machines</span>
      </div>
      <div class="action-card-compact" (click)="navigateToReport('maintenance')">
        <i class="material-icons">build_circle</i>
        <span>Maintenance</span>
      </div>
      <div class="action-card-compact" (click)="navigateToReport('drilling')">
        <i class="material-icons">construction</i>
        <span>Drilling</span>
      </div>
      <div class="action-card-compact" (click)="navigateToReport('explosive')">
        <i class="material-icons">warning</i>
        <span>Explosives</span>
      </div>
      <div class="action-card-compact" (click)="navigateToNotifications()">
        <i class="material-icons">notifications</i>
        <span>Notifications</span>
        <span class="badge-mini" *ngIf="recentNotifications.length > 0">{{ recentNotifications.length }}</span>
      </div>
    </div>
  </div>

  <!-- Bottom Row: User Profile (Compact) -->
  <div class="grid-row-profile">
    <div class="section-header-compact">
      <i class="material-icons">account_circle</i>
      <h3>Profile</h3>
    </div>
    <div class="profile-card-compact" *ngIf="currentUser">
      <div class="profile-left">
        <div class="profile-avatar-compact">
          <span class="avatar-initials">{{ getInitials() }}</span>
        </div>
        <div class="profile-info">
          <h4>{{ currentUser.name }}</h4>
          <p class="profile-email">{{ currentUser.email }}</p>
          <span class="role-badge">General Manager</span>
        </div>
      </div>
      <div class="profile-details-compact">
        <div class="profile-detail-item">
          <span class="detail-label">Region</span>
          <span class="detail-value">{{ currentUser.region || 'All Regions' }}</span>
        </div>
        <div class="profile-detail-item">
          <span class="detail-label">Country</span>
          <span class="detail-value">{{ currentUser.country || 'Oman' }}</span>
        </div>
        <div class="profile-detail-item">
          <span class="detail-label">Contact</span>
          <span class="detail-value">{{ currentUser.omanPhone || currentUser.countryPhone || 'Not provided' }}</span>
        </div>
        <div class="profile-detail-item">
          <span class="detail-label">Status</span>
          <span class="detail-value">
            <span class="status-badge" [class]="'status-' + (currentUser.status || 'active').toLowerCase()">
              {{ currentUser.status || 'ACTIVE' }}
            </span>
          </span>
        </div>
      </div>
    </div>
  </div>

</div>
