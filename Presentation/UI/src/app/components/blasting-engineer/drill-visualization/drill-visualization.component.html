<div class="drill-visualization-container">
  <!-- Professional Header -->
  <div class="compact-header">
    <div class="header-left">
      <button class="back-btn" (click)="navigateToSites()">
        <i class="fas fa-arrow-left"></i> 
        <span>Back to Sites</span>
      </button>
      <div class="title-group">
        <h2 class="page-title">
          <i class="fas fa-chart-line"></i>
          <span>Drill Hole Visualization</span>
        </h2>
        <div class="data-status" *ngIf="isDataLoaded">
          <i class="fas fa-check-circle"></i>
          <span>{{ totalHoles }} holes loaded</span>
        </div>
        <div class="data-status no-data" *ngIf="!isDataLoaded">
          <i class="fas fa-exclamation-circle"></i>
          <span>No data available</span>
        </div>
      </div>
    </div>
    
    <div class="header-right" *ngIf="isDataLoaded">
      <!-- Enhanced Mode Indicator -->
      <div class="mode-badge" [class.mode-3d]="visualization3DCapable" [class.mode-2d]="isIn2DMode">
        <i class="fas fa-cube" *ngIf="visualization3DCapable"></i>
        <i class="fas fa-layer-group" *ngIf="isIn2DMode"></i>
        <span>{{ visualization3DCapable ? '3D Visualization' : '2D Table View' }}</span>
      </div>
      
      <!-- Enhanced Quick Stats -->
      <div class="quick-stats">
        <div class="stat-item" title="Coverage Area">
          <i class="fas fa-expand-arrows-alt"></i>
          <div class="stat-content">
            <span class="stat-label">Area</span>
            <span class="stat-value">{{ ((getMaxEasting() - getMinEasting()) * (getMaxNorthing() - getMinNorthing()) / 1000000).toFixed(2) }} km²</span>
          </div>
        </div>
        <div class="stat-item" title="Elevation Range">
          <i class="fas fa-mountain"></i>
          <div class="stat-content">
            <span class="stat-label">Elevation</span>
            <span class="stat-value">{{ (getMaxElevation() - getMinElevation()).toFixed(1) }}m</span>
          </div>
        </div>
        <div class="stat-item" title="Total Drill Holes">
          <i class="fas fa-bullseye"></i>
          <div class="stat-content">
            <span class="stat-label">Holes</span>
            <span class="stat-value">{{ totalHoles }}</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Enhanced Messages Section -->
    <div class="enhanced-messages" *ngIf="saveMessage || deleteMessage || errorMessage">
      <div class="alert alert-success" *ngIf="saveMessage && !errorMessage">
        <i class="fas fa-check-circle"></i>
        <div class="alert-content">
          <span class="alert-title">Success</span>
          <span class="alert-message" [innerHTML]="saveMessage"></span>
        </div>
      </div>
      <div class="alert alert-success" *ngIf="deleteMessage">
        <i class="fas fa-check-circle"></i>
        <div class="alert-content">
          <span class="alert-title">Deleted</span>
          <span class="alert-message" [innerHTML]="deleteMessage"></span>
        </div>
      </div>
      <div class="alert alert-error" *ngIf="errorMessage">
        <i class="fas fa-exclamation-triangle"></i>
        <div class="alert-content">
          <span class="alert-title">Error</span>
          <span class="alert-message" [innerHTML]="errorMessage"></span>
        </div>
      </div>
    </div>

    <!-- Professional Control Panel -->
    <div class="compact-control-panel" *ngIf="isDataLoaded">
      <div class="control-section">
        <div class="section-title">
          <i class="fas fa-cog"></i>
          <span>Visualization Controls</span>
        </div>
        <div class="control-row">
          <!-- View Toggle Section -->
          <div class="control-group">
            <label class="control-label">View Mode</label>
            <div class="button-group view-toggle">
              <button (click)="toggle3DView()" class="btn btn-primary" [class.active]="show3DView">
                <i class="fas fa-cube"></i>
                <span>3D Visualization</span>
              </button>
              <button (click)="toggle3DView()" class="btn btn-secondary" [class.active]="!show3DView">
                <i class="fas fa-table"></i>
                <span>Data Table</span>
              </button>
            </div>
          </div>

          <!-- 3D Controls Section -->
          <div class="control-group" *ngIf="show3DView">
            <label class="control-label">3D Options</label>
            <div class="button-group">
              <button (click)="toggleLabels()" class="btn btn-outline" [class.active]="showLabels" title="Toggle hole labels">
                <i class="fas fa-tag"></i>
                <span>Labels</span>
              </button>
              <button (click)="resetCamera()" class="btn btn-outline" title="Reset camera view">
                <i class="fas fa-video"></i>
                <span>Reset View</span>
              </button>
              <button (click)="refresh3DVisualization()" class="btn btn-outline" title="Refresh 3D scene">
                <i class="fas fa-sync"></i>
                <span>Refresh</span>
              </button>
            </div>
          </div>

          <!-- Action Controls Section -->
          <div class="control-group">
            <label class="control-label">Data Actions</label>
            <div class="button-group">
              <button (click)="exportToPatternCreator()" class="btn btn-primary" [disabled]="!isDataLoaded" title="Export drill data to Pattern Creator">
                <i class="fas fa-external-link-alt"></i>
                <span>Export to Pattern Creator</span>
              </button>
              <button (click)="saveDrillData()" class="btn btn-success" [disabled]="isSaving" title="Save drill data to database">
                <i class="fas fa-save" *ngIf="!isSaving"></i>
                <i class="fas fa-spinner fa-spin" *ngIf="isSaving"></i>
                <span>{{ isSaving ? 'Saving...' : 'Save Data' }}</span>
              </button>
              <button (click)="reloadDataFromDatabase()" class="btn btn-secondary" title="Reload data from database">
                <i class="fas fa-sync-alt"></i>
                <span>Reload</span>
              </button>
              <button (click)="deleteAllDrillData()" class="btn btn-danger" [disabled]="isDeleting" title="Delete all drill data">
                <i class="fas fa-trash" *ngIf="!isDeleting"></i>
                <i class="fas fa-spinner fa-spin" *ngIf="isDeleting"></i>
                <span>{{ isDeleting ? 'Deleting...' : 'Delete All' }}</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced 3D Visualization Section -->
    <div *ngIf="show3DView" class="visualization-card">
      <div class="card-header">
        <div class="header-content">
          <h3 class="card-title">
            <i class="fas fa-cube"></i>
            <span>3D Drill Pattern Visualization</span>
          </h3>
          <div class="visualization-stats">
            <div class="stat-badge">
              <i class="fas fa-eye"></i>
              <span>{{ visualization3DCapable ? '3D Mode' : '2D Mode' }}</span>
            </div>
            <div class="stat-badge" *ngIf="holesWithAzimuthAndDip > 0">
              <i class="fas fa-compass"></i>
              <span>{{ holesWithAzimuthAndDip }} oriented holes</span>
            </div>
          </div>
        </div>
      </div>
      
      <div class="canvas-wrapper">
        <!-- 3D Canvas Container -->
        <div class="threejs-container"></div>
        
        <!-- Enhanced Loading State -->
        <div *ngIf="!isDataLoaded" class="loading-overlay">
          <div class="loading-content">
            <div class="loading-spinner">
              <i class="fas fa-spinner fa-spin"></i>
            </div>
            <h3>Loading Drill Data</h3>
            <p>Preparing 3D visualization of drill hole patterns...</p>
            <div class="loading-progress">
              <div class="progress-bar"></div>
            </div>
          </div>
        </div>
        
        <!-- Enhanced Floating UI Overlays -->
        <div class="canvas-overlays" *ngIf="isDataLoaded">
          <!-- Professional Camera Controls -->
          <div class="camera-controls">
            <div class="control-group-title">
              <i class="fas fa-video"></i>
              <span>Camera</span>
            </div>
            <button class="camera-btn" (click)="setTopView()" title="Top View (Plan View)">
              <i class="fas fa-eye"></i>
              <span>Top</span>
            </button>
            <button class="camera-btn" (click)="setSideView()" title="Side View (Elevation)">
              <i class="fas fa-arrows-alt-h"></i>
              <span>Side</span>
            </button>
            <button class="camera-btn" (click)="setIsometricView()" title="Isometric View">
              <i class="fas fa-cube"></i>
              <span>ISO</span>
            </button>
            <button class="camera-btn" (click)="autoFramePattern()" title="Auto Frame Pattern">
              <i class="fas fa-expand-arrows-alt"></i>
              <span>Fit</span>
            </button>
            <button class="camera-btn" (click)="toggleAutoRotate()" title="Toggle Auto Rotate">
              <i class="fas fa-sync-alt"></i>
              <span>Rotate</span>
            </button>
          </div>

          <!-- Enhanced 3D Options Panel -->
          <div class="options-panel">
            <div class="control-group-title">
              <i class="fas fa-sliders-h"></i>
              <span>Display Options</span>
            </div>
            <div class="option-item">
              <label class="option-toggle">
                <input type="checkbox" [checked]="showLabels" (change)="toggleLabels()">
                <span class="toggle-slider"></span>
                <span class="toggle-label">Show Labels</span>
              </label>
            </div>
            <div class="option-item">
              <label class="option-toggle">
                <input type="checkbox" [checked]="showDetailedLabels" (change)="showDetailedLabels = !showDetailedLabels">
                <span class="toggle-slider"></span>
                <span class="toggle-label">Detailed Info</span>
              </label>
            </div>
          </div>

          <!-- Enhanced Performance Info -->
          <div class="performance-info">
            <div class="perf-item">
              <i class="fas fa-tachometer-alt"></i>
              <span>WebGL Accelerated</span>
            </div>
            <div class="perf-item" *ngIf="totalHoles > 0">
              <i class="fas fa-memory"></i>
              <span>{{ totalHoles }} Objects</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced Data Table Section -->
    <div *ngIf="!show3DView && isDataLoaded" class="data-card">
      <div class="table-header">
        <div class="header-content">
          <h4 class="table-title">
            <i class="fas fa-table"></i>
            <span>Drill Hole Data</span>
            <span class="record-count">({{ totalHoles }} records)</span>
          </h4>
          <div class="table-actions">
            <button class="btn btn-outline btn-sm" title="Export data">
              <i class="fas fa-download"></i>
              <span>Export</span>
            </button>
          </div>
        </div>
        <div class="table-controls">
          <div class="bounds-summary">
            <div class="bound-group">
              <span class="bound-label">Coordinates</span>
              <div class="bound-items">
                <span class="bound-item">
                  <i class="fas fa-arrows-alt-h"></i>
                  <span>E: {{getMinEasting() | number:'1.0-0'}} - {{getMaxEasting() | number:'1.0-0'}}</span>
                </span>
                <span class="bound-item">
                  <i class="fas fa-arrows-alt-v"></i>
                  <span>N: {{getMinNorthing() | number:'1.0-0'}} - {{getMaxNorthing() | number:'1.0-0'}}</span>
                </span>
                <span class="bound-item">
                  <i class="fas fa-mountain"></i>
                  <span>Elev: {{getMinElevation() | number:'1.0-0'}} - {{getMaxElevation() | number:'1.0-0'}}m</span>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Enhanced Compact Table -->
      <div class="compact-table-container">
        <table class="compact-data-table">
          <thead>
            <tr>
              <th class="col-id">
                <i class="fas fa-hashtag"></i>
                <span>ID</span>
              </th>
              <th class="col-coordinate">
                <i class="fas fa-map-marker-alt"></i>
                <span>Easting</span>
              </th>
              <th class="col-coordinate">
                <i class="fas fa-map-marker-alt"></i>
                <span>Northing</span>
              </th>
              <th class="col-elevation">
                <i class="fas fa-mountain"></i>
                <span>Elevation</span>
              </th>
              <th class="col-depth">
                <i class="fas fa-ruler-vertical"></i>
                <span>Depth</span>
              </th>
              <th class="col-angle">
                <i class="fas fa-compass"></i>
                <span>Azimuth</span>
              </th>
              <th class="col-angle">
                <i class="fas fa-angle-down"></i>
                <span>Dip</span>
              </th>
              <th class="col-depth">
                <i class="fas fa-layer-group"></i>
                <span>Stemming</span>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let hole of drillData; let i = index" [class.even]="i % 2 === 0" class="data-row">
              <td class="hole-id">
                <span class="hole-badge">{{hole.name || hole.id}}</span>
              </td>
              <td class="coordinate-value">{{hole.easting | number:'1.0-0'}}</td>
              <td class="coordinate-value">{{hole.northing | number:'1.0-0'}}</td>
              <td class="elevation-value">{{hole.elevation | number:'1.0-0'}}</td>
              <td class="depth-value">
                <span class="value-badge depth">{{hole.depth | number:'1.0-0'}}m</span>
              </td>
              <td class="angle-value">
                <span class="value-badge angle">{{hole.azimuth}}°</span>
              </td>
              <td class="angle-value">
                <span class="value-badge angle">{{hole.dip}}°</span>
              </td>
              <td class="depth-value">
                <span class="value-badge stemming">{{hole.stemming | number:'1.0-0'}}m</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Enhanced No Data Section -->
    <div *ngIf="!isDataLoaded" class="no-data-card">
      <div class="empty-state">
        <div class="empty-icon">
          <i class="fas fa-database"></i>
        </div>
        <h4>No Drill Data Available</h4>
        <p class="empty-description">
          No drill hole data has been uploaded for this site yet. 
          Upload a CSV file containing drill hole coordinates, depths, and orientations to begin visualization.
        </p>
        
        <div class="empty-features">
          <div class="feature-item">
            <i class="fas fa-cube"></i>
            <span>3D Visualization</span>
          </div>
          <div class="feature-item">
            <i class="fas fa-table"></i>
            <span>Data Tables</span>
          </div>
          <div class="feature-item">
            <i class="fas fa-chart-line"></i>
            <span>Pattern Analysis</span>
          </div>
        </div>
        
        <div class="empty-actions">
          <button (click)="navigateToCSVUpload()" class="btn btn-primary btn-upload">
            <i class="fas fa-upload"></i>
            <span>Upload CSV Data</span>
          </button>
          <button (click)="reloadDataFromDatabase()" class="btn btn-secondary" *ngIf="projectId && siteId" title="Try to reload data from database">
            <i class="fas fa-sync-alt"></i>
            <span>Reload from Database</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
