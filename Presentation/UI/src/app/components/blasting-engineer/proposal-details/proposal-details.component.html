<div class="proposal-details-container" *ngIf="proposalData">
  <!-- Header Section with Gradient -->
  <div class="details-header">
    <div class="header-content">
      <div class="title-row">
        <i class="material-icons header-icon">description</i>
        <div class="title-info">
          <h2 class="details-title">Explosive Approval Request</h2>
          <div class="proposal-id">Request ID: #{{ proposalData.id }}</div>
        </div>
      </div>
      <span class="status-badge large" [ngClass]="'status-' + proposalData.status?.toLowerCase()">
        {{ proposalData.status }}
      </span>
    </div>
    <button class="close-btn" (click)="closeDetails()" title="Close">
      <i class="material-icons">close</i>
    </button>
  </div>

  <!-- Content Grid -->
  <div class="details-content">

    <!-- Left Column -->
    <div class="details-column">

      <!-- Request Information Card -->
      <div class="details-card">
        <div class="card-header">
          <i class="material-icons">event_note</i>
          <h3>Request Information</h3>
        </div>
        <div class="card-body">
          <div class="info-row">
            <div class="info-label">
              <i class="material-icons small">calendar_today</i>
              Expected Usage Date
            </div>
            <div class="info-value">{{ proposalData.expectedUsageDate | date:'MMMM d, yyyy' }}</div>
          </div>
          <div class="info-row full-width">
            <div class="info-label">
              <i class="material-icons small">comment</i>
              Comments
            </div>
            <div class="info-value comments-text">{{ proposalData.comments || 'No comments provided' }}</div>
          </div>
        </div>
      </div>

      <!-- Requester Information Card -->
      <div class="details-card">
        <div class="card-header">
          <i class="material-icons">person</i>
          <h3>Requester Information</h3>
        </div>
        <div class="card-body">
          <div class="info-row">
            <div class="info-label">
              <i class="material-icons small">badge</i>
              Name
            </div>
            <div class="info-value">{{ proposalData.requesterName }}</div>
          </div>
          <div class="info-row">
            <div class="info-label">
              <i class="material-icons small">email</i>
              Email
            </div>
            <div class="info-value email-text">{{ proposalData.requesterEmail }}</div>
          </div>
          <div class="info-row">
            <div class="info-label">
              <i class="material-icons small">fingerprint</i>
              User ID
            </div>
            <div class="info-value">{{ proposalData.requesterId }}</div>
          </div>
          <div class="info-row">
            <div class="info-label">
              <i class="material-icons small">location_city</i>
              Region
            </div>
            <div class="info-value">{{ proposalData.requesterRegion }}</div>
          </div>
        </div>
      </div>

      <!-- Project & Site Information Card -->
      <div class="details-card">
        <div class="card-header">
          <i class="material-icons">location_on</i>
          <h3>Project & Site Information</h3>
        </div>
        <div class="card-body">
          <div class="info-row">
            <div class="info-label">
              <i class="material-icons small">place</i>
              Project Site
            </div>
            <div class="info-value">{{ proposalData.projectSite }}</div>
          </div>
          <div class="info-row">
            <div class="info-label">
              <i class="material-icons small">work</i>
              Project Name
            </div>
            <div class="info-value">{{ proposalData.projectName || 'Unknown Project' }}</div>
          </div>
          <div class="info-row">
            <div class="info-label">
              <i class="material-icons small">public</i>
              Project Region
            </div>
            <div class="info-value">{{ proposalData.projectRegion || 'N/A' }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div class="details-column">

      <!-- Explosive Totals Card -->
      <div class="details-card explosive-card">
        <div class="card-header">
          <i class="material-icons">local_fire_department</i>
          <h3>Explosive Totals</h3>
        </div>
        <div class="card-body">
          <div class="explosive-summary">
            <div class="explosive-stat anfo">
              <div class="stat-icon">
                <i class="material-icons">science</i>
              </div>
              <div class="stat-details">
                <div class="stat-label">Total ANFO</div>
                <div class="stat-value">{{ (proposalData.totalAnfo || 0).toFixed(2) }} <span>kg</span></div>
              </div>
            </div>
            <div class="explosive-stat emulsion">
              <div class="stat-icon">
                <i class="material-icons">water_drop</i>
              </div>
              <div class="stat-details">
                <div class="stat-label">Total Emulsion</div>
                <div class="stat-value">{{ (proposalData.totalEmulsion || 0).toFixed(2) }} <span>kg</span></div>
              </div>
            </div>
            <div class="explosive-stat total">
              <div class="stat-icon">
                <i class="material-icons">balance</i>
              </div>
              <div class="stat-details">
                <div class="stat-label">Combined Total</div>
                <div class="stat-value">{{ ((proposalData.totalAnfo || 0) + (proposalData.totalEmulsion || 0)).toFixed(2) }} <span>kg</span></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Processing Information Card -->
      <div class="details-card">
        <div class="card-header">
          <i class="material-icons">settings</i>
          <h3>Processing Information</h3>
        </div>
        <div class="card-body">
          <div class="info-row">
            <div class="info-label">
              <i class="material-icons small">person_outline</i>
              Processed By
            </div>
            <div class="info-value">{{ proposalData.processedBy || 'Not processed yet' }}</div>
          </div>
          <div class="info-row">
            <div class="info-label">
              <i class="material-icons small">alternate_email</i>
              Processor Email
            </div>
            <div class="info-value email-text">{{ proposalData.processorEmail || 'N/A' }}</div>
          </div>
          <div class="info-row">
            <div class="info-label">
              <i class="material-icons small">schedule</i>
              Processed At
            </div>
            <div class="info-value">
              {{ proposalData.processedAt ? (proposalData.processedAt | date:'MMM d, yyyy \'at\' h:mm a') : 'Not processed yet' }}
            </div>
          </div>
          <div class="info-row full-width" *ngIf="proposalData.rejectionReason">
            <div class="info-label rejection">
              <i class="material-icons small">warning</i>
              Rejection Reason
            </div>
            <div class="info-value rejection-reason">{{ proposalData.rejectionReason }}</div>
          </div>
        </div>
      </div>

      <!-- Timestamps Card -->
      <div class="details-card">
        <div class="card-header">
          <i class="material-icons">access_time</i>
          <h3>Timestamps</h3>
        </div>
        <div class="card-body">
          <div class="info-row">
            <div class="info-label">
              <i class="material-icons small">add_circle</i>
              Created At
            </div>
            <div class="info-value">{{ proposalData.createdAt | date:'MMM d, yyyy \'at\' h:mm a' }}</div>
          </div>
          <div class="info-row">
            <div class="info-label">
              <i class="material-icons small">update</i>
              Updated At
            </div>
            <div class="info-value">{{ proposalData.updatedAt | date:'MMM d, yyyy \'at\' h:mm a' }}</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div class="loading-container" *ngIf="!proposalData && isLoading">
  <div class="loading-spinner"></div>
  <p>Loading proposal details...</p>
</div>

<!-- Error State -->
<div class="error-container" *ngIf="!proposalData && !isLoading && hasError">
  <span class="error-icon">⚠️</span>
  <p>Failed to load proposal details. Please try again.</p>
  <button class="retry-btn" (click)="retryLoad()">Retry</button>
</div>