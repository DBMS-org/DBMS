<div class="job-details">
  <!-- Back Button -->
  <button class="back-btn" (click)="goBack()">
    <i class="material-icons">arrow_back</i>
    Back to Maintenance Jobs
  </button>

  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Loading job details...</p>
    </div>
  }

  <!-- Error State -->
  @if (errorMessage) {
    <div class="error-alert">
      <i class="material-icons">error_outline</i>
      <span>{{ errorMessage }}</span>
    </div>
  }

  <!-- Job Details -->
  @if (job && !isLoading) {
    <div class="job-header">
      <div class="job-title">
        <h1>Maintenance Job #{{ job.id }}</h1>
        <span class="status-badge" [ngClass]="getStatusClass(job.status)">{{ job.status }}</span>
        <span class="type-badge" [ngClass]="getTypeClass(job.type)">{{ job.type }}</span>
      </div>
    </div>

    <div class="details-grid">
      <!-- Machine Information -->
      <div class="detail-card">
        <h3><i class="material-icons">precision_manufacturing</i> Machine Information</h3>
        <div class="detail-row">
          <span class="label">Machine Name:</span>
          <span class="value">{{ job.machineName }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Model:</span>
          <span class="value">{{ job.machineModel }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Serial Number:</span>
          <span class="value">{{ job.serialNumber }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Project:</span>
          <span class="value">{{ job.projectName || 'N/A' }}</span>
        </div>
      </div>

      <!-- Job Information -->
      <div class="detail-card">
        <h3><i class="material-icons">assignment</i> Job Information</h3>
        <div class="detail-row">
          <span class="label">Type:</span>
          <span class="value">{{ job.type }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Status:</span>
          <span class="value">{{ job.status }}</span>
        </div>
        <div class="detail-row">
          <span class="label">Scheduled Date:</span>
          <span class="value">{{ job.scheduledDate | date:'medium' }}</span>
        </div>
        @if (job.completedDate) {
          <div class="detail-row">
            <span class="label">Completed Date:</span>
            <span class="value">{{ job.completedDate | date:'medium' }}</span>
          </div>
        }
        @if (job.reason) {
          <div class="detail-row">
            <span class="label">Reason:</span>
            <span class="value">{{ job.reason }}</span>
          </div>
        }
      </div>

      <!-- Service Alert Info -->
      @if (job.serviceAlertLevel) {
        <div class="detail-card alert-card">
          <h3><i class="material-icons">warning</i> Service Alert</h3>
          <div class="detail-row">
            <span class="label">Alert Level:</span>
            <span class="value alert-level">{{ job.serviceAlertLevel }}</span>
          </div>
          <div class="detail-row">
            <span class="label">Auto Generated:</span>
            <span class="value">{{ job.isAutoGenerated ? 'Yes' : 'No' }}</span>
          </div>
        </div>
      }

      <!-- Assignment Information -->
      <div class="detail-card">
        <h3><i class="material-icons">person</i> Assignment</h3>
        @if (job.assignments && job.assignments.length > 0) {
          @for (assignment of job.assignments; track assignment.id) {
            <div class="assignment-item">
              <div class="detail-row">
                <span class="label">Engineer:</span>
                <span class="value">{{ assignment.mechanicalEngineerName }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Assigned:</span>
                <span class="value">{{ assignment.assignedAt | date:'medium' }}</span>
              </div>
            </div>
          }
        } @else {
          <p class="no-data">No engineers assigned</p>
        }
      </div>

      <!-- Linked Report -->
      @if (job.maintenanceReportId) {
        <div class="detail-card">
          <h3><i class="material-icons">description</i> Linked Report</h3>
          <div class="detail-row">
            <span class="label">Report ID:</span>
            <span class="value">#{{ job.maintenanceReportId }}</span>
          </div>
          @if (job.reportTicketId) {
            <div class="detail-row">
              <span class="label">Ticket ID:</span>
              <span class="value">{{ job.reportTicketId }}</span>
            </div>
          }
        </div>
      }

      <!-- Observations -->
      @if (job.observations) {
        <div class="detail-card full-width">
          <h3><i class="material-icons">notes</i> Observations</h3>
          <p class="notes-content">{{ job.observations }}</p>
        </div>
      }
    </div>
  }
</div>
